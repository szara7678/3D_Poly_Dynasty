## 2025-01-27 - 마우스 드래그 맵 이동 버튼 변경

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - OrbitControls의 마우스 버튼 설정 변경
   - 왼쪽 버튼: 맵 이동(PAN) 기능으로 변경
   - 오른쪽 버튼: 카메라 회전(ROTATE) 기능으로 변경
   - 가운데 버튼: 줌(DOLLY) 기능 유지
   - 모바일 터치 설정 추가: 한 손가락으로 팬(맵 이동), 두 손가락으로 줌/회전

### 🎮 변경 내용
- 기존: 마우스 오른쪽 드래그로 맵 이동
- 변경: 마우스 왼쪽 드래그로 맵 이동
- 모바일: 한 손가락 터치로 맵 이동, 두 손가락 터치로 줌/회전
- 사용자 편의성 향상을 위한 조작 방식 개선

### 📈 효과
- 더 직관적인 마우스 조작 방식 제공
- 일반적인 3D 애플리케이션과 일관된 조작감
- 모바일과 데스크톱 환경 모두에서 일관된 사용자 경험 제공

## 2025-09-15 - 잔상/깜빡임 개선(렌더러 불투명 전환 + RAF 정리)

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - `WebGLRenderer({ alpha:false, powerPreference:'high-performance', premultipliedAlpha:false, depth:true, stencil:false })`
   - `renderer.autoClear = true; renderer.setClearColor(0xeaf7ff, 1);`
   - 렌더 루프에 `running` 플래그 및 `rafId` 추가, 언마운트 시 `cancelAnimationFrame(rafId)`와 함께 중단

### 🐛 해결된 현상
- 간헐적 잔상/화면 깜빡임(특히 탭 전환/리마운트 후) 현상 완화
- 중복 RAF로 인한 프레임 타이밍 충돌 방지

### 📈 효과
- 프레임 안정성 향상 및 합성 레이어 아티팩트 제거
- 장시간 플레이/탭 전환 시 시각적 일관성 개선

## 2025-01-27 - 창고 및 제작 시스템 구현

### 🔧 변경 파일
1. `src/game/content/items.js` (신규)
   - 아이템 정의 시스템 구현
   - 소비 아이템: 재료 상자, 재능 상승, 스탯 상승 아이템
   - 장비 아이템: 무기(검), 갑옷, 악세사리(반지)
   - 아이템별 제작 비용 및 효과 정의

2. `src/game/systems/warehouse.js` (신규)
   - 창고 시스템 관리
   - 아이템 추가/제거, 사용/장착 기능
   - 아이템 분류별 필터링 함수
   - 장비 착용/해제 관리

3. `src/game/systems/crafting.js` (신규)
   - 제작 시스템 관리
   - 대장간/마탑 시민 숙련도 기반 제작 비용 계산
   - 아이템 제작 가능 여부 확인
   - 제작 가능한 아이템 목록 제공

4. `src/components/WarehouseTab.jsx` (신규)
   - 창고 탭 UI 컴포넌트
   - 아이템 목록 표시 및 분류별 필터링
   - 아이템 클릭 시 인스펙터 표시

5. `src/components/CraftingTab.jsx` (신규)
   - 제작 탭 UI 컴포넌트
   - 제작 가능한 아이템 목록 표시
   - 시민 숙련도 기반 제작 비용 표시
   - 아이템 제작 실행

6. `src/components/ItemInspector.jsx` (신규)
   - 아이템 인스펙터 컴포넌트
   - 아이템 정보 표시 및 이름 변경
   - 사용/장착 버튼 제공

7. `src/components/MainMenu.jsx`
   - 창고📦, 제작🔨 탭 추가
   - 새로운 탭 컴포넌트 통합

8. `src/components/Inspector.jsx`
   - 아이템 인스펙터 통합
   - 아이템 선택 시 하단 인스펙터 표시

9. `src/game/state.js`
   - 창고 시스템 상태 추가
   - 아이템 선택 상태 관리
   - 초기 아이템 추가

### 🎮 새로운 기능
- **창고 시스템**: 아이템 저장 및 관리, 종류별 필터링
- **제작 시스템**: 시민 숙련도 기반 아이템 제작
- **아이템 시스템**: 소비/장비 아이템 분류 및 효과
- **아이템 인스펙터**: 아이템 정보 확인 및 사용/장착

### 📈 효과
- 게임의 깊이와 전략성 향상
- 시민 숙련도 활용도 증가
- 자원 관리의 다양성 증대

## 2025-01-27 - 건물 생산 완료 시 자원 이모지 표시 시스템 구현

### 🔧 변경 파일
1. `src/components/managers/ResourceDisplayManager.js` (신규)
   - 건물 생산 완료 시 자원 이모지와 생산량을 표시하는 매니저 클래스
   - 건물 위에 올라가면서 사라지는 애니메이션 효과 구현
   - 자원별 이모지 매핑 (wood: 🪵, stone: 🪨, food: 🍎, gold: 🪙 등)
   - 2초간 표시되며 1.5초 후부터 페이드 아웃 효과

2. `src/components/Scene3D.jsx`
   - ResourceDisplayManager 통합 및 초기화
   - 렌더 루프에 자원 표시 애니메이션 업데이트 추가
   - 전역 접근을 위한 window.__INSU_THREE_REF__ 설정
   - 정리 함수에서 리소스 해제 처리

3. `src/game/systems/production.js`
   - 생산 완료 시 자원 표시 생성 로직 추가
   - 건물 위치 정보를 기반으로 자원 표시 생성
   - 전역 threeRef를 통한 ResourceDisplayManager 접근

### 🎯 기능
- 건물에서 생산이 완료될 때마다 건물 위에 자원 이모지와 생산량이 표시됨
- 자원 표시는 건물 위로 올라가면서 자연스럽게 사라지는 애니메이션
- 각 자원별로 고유한 이모지 사용 (나무🪵, 금🪙, 음식🍎 등)
- 생산량이 숫자로 함께 표시되어 시각적 피드백 제공

### 📈 효과
- 생산 활동의 시각적 피드백으로 게임 몰입감 향상
- 건물별 생산 상태를 직관적으로 파악 가능
- 자원 획득의 즉각적인 시각적 확인으로 만족감 증대

---

## 2025-01-27 - 건물 철거 후 라벨 정리 문제 수정

### 🔧 변경 파일
1. `src/components/managers/LabelManager.js`
   - 건물 삭제 시 해당 건물의 worker 라벨들이 제대로 정리되지 않는 문제 수정
   - `updateConstructionLabels` 메서드에 삭제된 건물의 worker 라벨 정리 로직 추가
   - 건물이 삭제된 경우 해당 건물의 모든 worker 라벨을 자동으로 제거하도록 개선

### 🐛 수정된 문제
- 건물 철거 후 건물 상단에 있던 이름 박스(라벨)들이 사라지지 않던 문제 해결
- 메모리 누수 방지: 삭제된 건물의 라벨 리소스가 제대로 해제되도록 개선

---
## 2025-09-16 - 밸런스 조정: 마을 크기/명성/인구 증가 속도 하향

### 🔧 변경 파일
1. `src/components/managers/TownRangeManager.js`
   - 마을 회관 범위 반경 공식을 `30 + 10*(level-1)` → `24 + 8*(level-1)`로 조정
2. `src/components/managers/InteractionHandler.js`
   - 건물 배치 유효성 검사에서 회관 범위 체크 반경 동일하게 조정
3. `src/game/systems/reputation.js`
   - `REP_SOFT_CAP` 200 → 180
   - 틱당 명성 최대 증가 0.1 → 0.05
   - 합성 명성 스케일 0.2 → 0.14, 최종 적용 시 0.7배
4. `src/game/systems/populationGrowth.js`
   - 요소 가중합 전체에 0.8배 스케일 적용, 최종 캡 0.05 → 0.035
   - 기본/명성/건물/수련/자원 기반 확률 전반 하향, 근상한 페널티 0.5 → 0.4
   - 일부 임계값/이상적 비율(idealRatio 4.0 → 4.2) 조정

### 🎯 목적
- 초기 마을 활동 영역 축소로 난이도와 선택 압력 증가
- 명성/인구 성장 템포 완만화로 중장기 progression 개선

### 📈 효과(예상)
- 초반 건물 배치가 더 조밀해지고 확장 결정의 의미 강화
- 명성 누적과 인구 유입이 느려져 자원/배치/수련의 전략 가치 상승

## 2025-09-15 - 시민 재능/레벨/표시 개편 + 생산력 미리보기

### 🔧 변경 파일
1. `src/game/content/units.js`
   - `rollTalent()`을 모든 스킬 최소 1 이상으로 변경(초기 재능 1~10)
2. `src/game/factory/citizen.js`
   - 시민 객체에서 `level`/`exp` 필드 완전 제거
3. `src/components/Inspector.jsx`
   - 시민 인스펙터 기본정보에서 레벨 → 직업(속한 건물)로 표시 변경
   - 건물 인스펙터의 배치/유휴 목록 우측에 해당 건물에서의 예상 생산력 표시 추가
     (생산 공식 단순화 버전 사용, 자원키와 수치 표시)
4. `src/components/MainMenu.jsx`
   - 시민 탭에서 `Lv.` 제거, 우측에 현재 직업(속한 건물) 표기로 교체
5. `README.md`
   - 시민 데이터 구조/인스펙터 설명 최신화(모든 스킬 최소 1, 레벨 → 직업)

### 🐛/🎯 목적
- 시민이 태어날 때 모든 스킬의 재능을 보유하도록 통일(최소 1)
- 시민 레벨 개념 제거로 단순화, UI에서 직업 중심 정보 제공
- 배치/배치 후보 목록에서 생산력 미리보기로 인사 배치 판단 지원

### 📈 효과
- 초반 시민 성장이 막히지 않고 모든 분야에 참여 가능
- UI 가독성 향상: 레벨 대신 실사용 정보(직업/생산력) 중심
- 인력 배치 결정이 직관적으로 개선


## 2025-09-11 - 시작 렉 급증 원인 최적화

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - 프레임 루프에서 `labelManager.updateConstructionLabels` 호출 제거 → 구독 콜백에서만 호출
   - 구독 콜백에 라벨 갱신 추가, 건물/범위/선택 링 업데이트와 동기화

2. `src/components/managers/InteractionHandler.js`
   - 이벤트 리스너 바인딩을 인스턴스 필드로 고정(`this._onMove` 등)하여 dispose 시 정확히 해제되도록 수정

3. `src/components/agents/Agents.jsx`
   - 인스턴스 색상 업데이트 캐싱: 최초 할당 시에만 색상 버퍼 갱신, 매 프레임 갱신 제거

4. `src/components/managers/LabelManager.js`
   - 숨김 시민 스캔 최적화: O(B*U) → O(B+U) (유닛 1회 순회로 빌딩별 그룹화)
   - 불필요한 라벨 정리 로직 개선

5. `src/components/managers/TownRangeManager.js`
   - 반경 변경시에만 지오메트리 재생성(캐시된 `_radius` 비교)

6. `src/game/gameLoop.js`
   - 고정 틱 루프 내 `notify()` 배치: 틱 누적 처리 후 1회만 알림

7. `src/game/state.js`
   - `notify()` coalescing 도입: 같은 프레임 내 다중 호출을 1회로 병합(queueMicrotask)

8. `src/game/systems/production.js`
   - 디버그 로그 가드(`window.__INSU_DEBUG_LOG__`) 추가로 콘솔 스팸 감소

### 🎯 효과
- 시작 시 및 초기 플레이에서의 프레임 드랍 감소
- 상태 변경/구독 기반 렌더 경량화, 라벨/범위/색상 업데이트 비용 감소
- 이벤트 리스너 누수 방지로 장시간 플레이 안정성 향상
# UPDATE.md - 프로젝트 작업 내역

## 2025-01-27 - GitHub Pages 자동 배포 설정 완료

### 🔧 변경 파일
1. `vite.config.js`
   - GitHub Pages 배포를 위한 base path 설정 추가 (`base: '/3d-world/'`)
   - 빌드 설정 최적화 (outDir, assetsDir, sourcemap 설정)

2. `.github/workflows/deploy.yml`
   - main 브랜치 푸시 시 자동 빌드 및 gh-pages 배포 설정
   - Node.js 18 환경에서 npm ci → npm run build → gh-pages 배포
   - 권한 문제 해결을 위한 설정 최적화

3. `package.json`
   - gh-pages 패키지 의존성 추가 (v6.3.0)
   - `npm run deploy` 스크립트 추가 (수동 배포용)

4. `README.md`
   - 자동 배포 설정 방법 안내 추가
   - GitHub 저장소 권한 설정 방법 상세 설명
   - 배포 URL 형식 안내 (`https://[사용자명].github.io/3d-world/`)

### 🎯 기능
- **자동 배포**: main 브랜치에 푸시할 때마다 자동으로 gh-pages 브랜치에 배포
- **수동 배포**: `npm run deploy` 명령어로 즉시 배포 가능
- **최적화된 빌드**: Vite 설정으로 GitHub Pages 서브디렉토리 배포에 최적화
- **배포 URL**: `https://[사용자명].github.io/3d-world/`에서 접속 가능

### 📈 효과
- 코드 변경 시 자동으로 웹에서 확인 가능
- GitHub Actions 권한 문제 해결 방법 안내
- 별도의 서버 없이 GitHub에서 무료 호스팅
- 개발 효율성 대폭 향상

---

## 2024년 12월 19일

### 🚀 프로젝트 초기 설정 완료

#### 생성된 파일들:
1. **package.json** - React Three Fiber 프로젝트 의존성 설정
   - React 18, @react-three/fiber, @react-three/drei, Three.js 포함
   - Vite 빌드 도구 설정

2. **index.html** - 메인 HTML 템플릿
   - Tailwind CSS CDN 연결
   - React 앱 마운트 포인트 설정

3. **vite.config.js** - Vite 설정 파일
   - React 플러그인 설정
   - 개발 서버 포트 3000 설정

4. **src/main.jsx** - React 앱 진입점
   - React 18 StrictMode 설정

5. **src/App.jsx** - 메인 App 컴포넌트
   - WalkingHuman3D 컴포넌트 렌더링

6. **src/index.css** - 기본 스타일
   - 전역 CSS 리셋 및 기본 폰트 설정

7. **src/components/WalkingHuman3D.jsx** - 3D 걷는 사람 컴포넌트
   - 기존 파일을 components 폴더로 이동
   - 스틱 피규어 애니메이션 로직 포함

8. **README.md** - 프로젝트 문서
   - 기능 설명, 사용법, 기술 스택 정보

#### 핵심 기능:
- **3D 현실적 캐릭터**: 근육 정의, 체형 커스터마이징이 가능한 사람 모양
- **절차적 걷기 애니메이션**: 수학적 계산을 통한 자연스러운 걷기 동작
- **실시간 컨트롤**: WASD 이동, Shift 달리기, Space 카메라 모드 토글
- **고급 커스터마이징**: 피부색, 의상색, 체형, 근육량, 체지방률 조절
- **향상된 조명**: 다중 조명과 그림자로 현실감 증대

#### 다음 단계:
- `npm install` 실행하여 의존성 설치
- `npm run dev` 실행하여 개발 서버 시작
- 브라우저에서 http://localhost:3000 접속하여 3D 애니메이션 확인

---

## 2024년 12월 19일 (추가)

### 🎮 3D 에이전트 인스턴싱 시스템 완전 교체

#### 변경된 파일:
1. **src/components/WalkingHuman3D.jsx** - 완전히 새로운 코드로 교체
   - 기존 단일 캐릭터 시스템을 다중 에이전트 인스턴싱 시스템으로 변경

#### 새로운 핵심 기능:
- **다중 에이전트 시뮬레이션**: 최대 800개까지의 귀여운 캐릭터 동시 렌더링
- **고성능 인스턴싱**: InstancedMesh를 사용한 최적화된 렌더링
- **파스텔 톤 색상**: 골든레시오 기반의 귀여운 파스텔 색상 시스템
- **유기적 움직임**: 각 에이전트별 개별적인 보행 패턴과 방향 변화
- **실시간 에이전트 수 조절**: 슬라이더로 1~800개 에이전트 수 조절
- **자동 성능 최적화**: 모바일 기기에서 자동으로 에이전트 수 감소

#### 기술적 특징:
- **인스턴싱 메쉬**: 몸통, 머리, 팔, 다리 각각의 InstancedMesh 사용
- **동적 색상**: 에이전트별 고유한 파스텔 색상 할당
- **스프링 애니메이션**: 몸통 스쿼시와 머리 지연 효과
- **경계 처리**: 활동 영역 내에서 자연스러운 방향 전환
- **반응형 UI**: 다크 테마의 모던한 UI 디자인

#### 성능 최적화:
- **모바일 최적화**: 자동으로 에이전트 수를 160개로 제한
- **픽셀 비율 조정**: 디바이스 성능에 따른 자동 조정
- **프레임 안정화**: 큰 프레임 변동 보호 로직

#### 사용법:
- **에이전트 수 조절**: 하단 UI의 슬라이더로 1~800개 조절
- **카메라 조작**: 마우스 드래그로 회전, 휠로 줌
- **자동 최적화**: 성능에 따라 자동으로 설정 조정

---

## 2025년 09월 04일

### 🧱 게임 스캐폴딩 추가 및 보행 물리 개선

#### 추가/수정 파일
1. `src/game/state.js` — 전역 상태/세이브/간단 액션(uid/addUnit/addBuilding)
2. `src/game/gameLoop.js` — 고정 틱 루프(0.5s), 세금/저장 타이머
3. `src/game/content/_defs.sample.js`, `content/buildings.js` — 건물 정의 템플릿
4. `src/game/systems/*` — `production/economy/reputation/construction/buildingXP/spawn`
5. `src/components/HUD.jsx` — 자원/인구/명성 HUD
6. `src/App.jsx` — 게임 루프/HUD 연결, 초기 상태 샘플 주입
7. `src/components/WalkingHuman3D.jsx` — 발 고정(foot planting) + 지면 추종 + `props.units/timeScale` 지원

#### 주요 변화
- 보행: 지지발 고정, 스윙발 곡선 이동, 경사 정상화 기반 지면 높이 추종
- 렌더: `units`가 주어지면 상태 구동형 좌표/방향/크기 반영, 없으면 기존 배회 유지(혼합 모드)
- 시뮬: 생산/세금/명성/건설/건물XP/간이 스폰 루프 작동

#### 다음 권장 작업
- BuildMenu/SelectionOverlay/Inspector 구현(입력→명령)
- construction/assignment 상세 구현(코스트/시간/배치)
- worldAI/spawn/combat 루프 최소 버전

## 2025년 09월 05일

### 🔁 상태 구독/알림(pub-sub) 도입 및 UI/렌더 반응형 전환

#### 변경 파일
1. `src/game/state.js`
   - `subscribe(listener)`/`notify()` 이벤트 버스 추가
   - `setRes`/`addUnit`/`addBuilding`에서 `notify()` 호출
2. `src/game/gameLoop.js`
   - 고정 틱 루프에서 `state.tick++` 직후 `notify()` 호출
3. `src/components/HUD.jsx`
   - 스토어 구독으로 자동 리렌더(실시간 자원/인구/명성 반영)
4. `src/components/agents/Agents.jsx`
   - `props.units` 반영: 외부 상태 기반 위치/방향/크기 렌더
   - 남는 슬롯은 내부 배회(혼합 모드 유지)
5. `src/components/Scene3D.jsx`
   - 변경 없음(하위 Agents가 상태 기반 렌더 지원)
6. `README.md`
   - 상태 구독/알림 방식 문서화 및 구조/설명 최신화

#### 효과
- HUD 수치가 틱/시스템 처리에 맞춰 즉시 갱신
- 에이전트가 외부 상태(`units`) 좌표를 따라 움직임
- 기존 랜덤 배회 시각도 유지되어 가시성/몰입 유지

### 🧱 Build/배치 최소 루프 추가

#### 추가/수정 파일
1. `src/components/BuildMenu.jsx`
   - 우측 상단 건설 메뉴 UI(코스트 표시/건설 버튼)
   - 클릭 시 비용 차감 후 건물 생성(건설 진행 시작), 유휴 인원 자동 배치
2. `src/game/state.js`
   - `canAfford`/`spend` 추가(코스트 체크/지출)
   - `assignUnitToBuilding`/`unassignUnit`/`idleUnits` 추가(배치/해제/유휴 조회)
3. `src/App.jsx`
   - `BuildMenu` 추가 렌더

#### 동작
- 건설 클릭 → 자원 확인/차감 → 건물 청사진 생성(`construct.active=true`) → 자동 배치
- `systems/construction.js`에서 `eta/progress` 감소 → 완료 시 활성화

### 🧭 2025년 09월 05일 (추가)

#### 🧊 배치 고스트/반경 예외/건물 렌더
- 배치 모드에서 마우스를 따라가는 청사진(투명 상자) 표시, 반경 내 유효 시 초록/불가 시 빨강
- 마을 회관은 반경 제한 미적용(어디든 건설 가능)
- 건물 렌더: InstancedMesh 박스 메쉬, 진행도에 따라 높이 증가로 공사 시각화

### 🧩 2025년 09월 06일

#### 🛡️ 배치 규칙 강화 + 시각화 개선
- BUILDING_DEFS에 `placeRadius` 추가(타입별 반경) → 겹침 판정은 두 건물 반지름 합으로 계산
- 고스트 스케일/배경 오브젝트 제거 반경을 `placeRadius` 기반으로 자동 조정
- 회관 반경 표시: 은은한 채움 + 진한 테두리 + 점선 + 반투명 벽(높이 2.5)
- 배치 불가(반경 밖/겹침)일 때 고스트·링·벽이 빨강으로 바뀌며 클릭도 무시

#### 🏗️ 배경 오브젝트 정리
- 배치 시 주변 반경 내 나무/선인장/바위/얼음 메쉬를 제거하여 건설 공간 확보
- 스캐터를 하나의 `Group`으로 관리해 성능/정리 용이

#### 🖱️ 선택/인스펙션
- 더블클릭으로 건물 선택 → 반경 기반 선택 링 표시, 카메라가 부드럽게 포커스 이동
- `Inspector` 패널 추가: 이름/레벨/HP/XP/공사 ETA·진행률, 배치 인원/유휴 인원 관리(배치/해제)

### 🧍‍♂️ 캐릭터 비율 및 모션 리파인

#### 수정 파일
- `src/components/WalkingHuman3D.jsx`

#### 변경 사항
- 얼굴 배치 보정: 눈 간격/높이/앞쪽 오프셋을 현실 비율에 가깝게 조정
- 팔다리 부착점 개선: 어깨 높이 상승, 약간의 전방 오프셋, 고관절 높이 하향 조정
- 보행 리듬 강화: 골반 좌우 스웨이, 상하 바운스, 어깨의 미세 요우/롤 추가로 자연스러운 실루엣
- 팔 스윙 개선: 전후 스윙과 약간의 좌우 흔들림 추가, 손 목표점 곡선 보정
- 입 위치 소폭 상향으로 표정 자연스러움 향상

### 🌍 지형 바이옴 시스템 + 현실적인 팔레트

#### 수정 파일
- `src/components/WalkingHuman3D.jsx`
- `src/world/terrain.js` (신규)

#### 변경 사항
- 팔: 긴 원통 대신 짧은 팔 + 구형 손 파트 추가, 다리 제거
- 상태 기반 모션: 
  - 걷기: 팔 전후 스윙, 몸 상하 바운스
  - 작업(채광/농사/벌목): 양손 위→아래 반복 동작 (느린 속도로 개선)
- 색상 팔레트: 기본값을 `realistic`로 변경(채도↓, 명도↓, 어스톤)
- 지형 모듈화: `src/world/terrain.js`로 분리하여 재사용성 향상
- 바이옴 분포 개선: 맵 크기 300x300으로 확장, 모든 바이옴이 균등하게 나타나도록 조정
- 바이옴별 오브젝트: 숲(나무+줄기), 평원(바위), 사막(선인장), 설원(얼음기둥) 스캐터링
- 오브젝트 밀도 증가: 1200개로 증가하여 바이옴 구분 명확화

#### 기대 효과
- 활동 종류에 따른 동작 차별화로 가독성과 몰입감 향상
- 맵이 생성될 때마다 규칙 있는 랜덤 바이옴 배치로 탐색 재미 증대
- 모든 바이옴이 맵에 균등하게 분포하여 다양성 확보

#### 기대 효과
- 팔다리가 몸통에 ‘붙어 있는’ 느낌 강화, 전신 균형감 개선
- 보행 중 무게중심 이동이 느껴져 더 사람다운 움직임 연출

## 2024년 12월 19일 (오류 수정)

### 🔧 Flow 타입 문법 오류 수정

#### 발생한 문제:
- **Babel 오류**: Flow 타입 문법이 지원되지 않아 컴파일 실패
- **오류 메시지**: "Support for the experimental syntax 'flow' isn't currently enabled"

#### 수정 내용:
1. **src/components/WalkingHuman3D.jsx** - Flow 타입 문법 완전 제거
   - `export type CuteAgents3DProps` 제거
   - `type Agent`, `type Parts` 등 모든 타입 정의 제거
   - 함수 매개변수의 타입 어노테이션 제거
   - `useRef<HTMLDivElement | null>(null)` → `useRef(null)` 변경

#### 수정된 구조:
- **순수 JavaScript**: 모든 Flow 타입 문법을 제거하고 일반 JavaScript로 변경
- **React 컴포넌트**: 기존 기능은 그대로 유지하면서 타입 문법만 제거
- **호환성 향상**: Babel 설정 없이도 정상 동작

#### 결과:
- ✅ 컴파일 오류 해결
- ✅ 개발 서버 정상 실행 가능
- ✅ 모든 기능 정상 동작
- ✅ 모바일 최적화 및 성능 최적화 유지

---

## 2025-01-12 - 주요 시스템 오류 해결

### 📋 작업 개요
**Scene3D.jsx 500 오류 및 관련 시스템 문제들을 종합적으로 해결**

사용자 보고 문제:
- Scene3D.jsx 파일 로딩 시 500 Internal Server Error
- 건물 고스트(청사진) 렌더링 안됨
- 마을 범위 겹치는 부분이 자연스럽지 않음
- 마을 회관 건설 시 에이전트 생성 문제

### 🔧 수정 사항

#### 1. Scene3D.jsx 완전 복구
**파일**: `src/components/Scene3D.jsx`
- **문제**: 파일이 손상되어 import/export 구문이 없고 구조가 불완전
- **해결**: 파일을 완전히 새로 작성하여 복구
  - React/Three.js 기본 구조 복구
  - 건물 인스턴싱 메쉬 시스템 복구
  - 건설 ETA 라벨 시스템 복구
  - 마우스 상호작용 (배치/선택) 복구
  - 카메라 포커스 및 키보드 컨트롤 복구

#### 2. terrain.js export 오류 해결
**파일**: `src/world/terrain.js`
- **문제**: `createTerrainSystem` 함수만 export하고 있어서 Scene3D.jsx에서 terrain 객체를 직접 import할 수 없음
- **해결**: 기본 terrain 인스턴스를 생성하여 export
```javascript
// 추가된 코드:
export const terrain = createTerrainSystem();
```

#### 3. 건물 고스트 메쉬 시스템 복구
**파일**: `src/components/Scene3D.jsx`
- **기능**: 배치 모드에서 건물 청사진 렌더링
- **구현**: 
  - state.ui.placing 상태에 따른 고스트 메쉬 생성/제거
  - 마우스 위치 추적 및 유효성 검사에 따른 색상 변경
  - 건물 크기에 맞는 스케일링

#### 4. 마을 범위 겹침 자연스러운 처리
**파일**: `src/components/Scene3D.jsx`
- **기능**: 다중 마을 회관의 범위가 겹칠 때 자연스러운 병합 효과
- **구현**:
  - 겹치는 마을 범위 감지 로직
  - 겹치는 부분의 투명도 조정 (opacity 감소)
  - 시각적으로 자연스러운 병합 효과

#### 5. 초기 에이전트 생성 문제 해결
**파일**: `src/App.jsx`
- **문제**: 초기 인구수가 0으로 설정되어 에이전트가 보이지 않음
- **해결**: 게임 시작 시 기본 시민 5명 생성
```javascript
// 수정된 코드:
const initialPopulation = 5;
for(let i=0;i<initialPopulation;i++){
  // 시민 생성 로직
}
state.population = initialPopulation;
```

### 📊 시스템 상태

#### 렌더링 시스템:
- ✅ Scene3D.jsx 완전 복구
- ✅ 건물 인스턴싱 메쉬 정상 작동
- ✅ 건물 고스트 렌더링 복구
- ✅ 마을 범위 표시 및 겹침 처리 개선
- ✅ 건설 ETA 라벨 시스템 정상 작동

#### 게임 시스템:
- ✅ 초기 시민 5명 생성
- ✅ 마을 회관 건설 시 시민 추가 (기존 로직 정상)
- ✅ 에이전트 렌더링 및 애니메이션 정상
- ✅ 건물 배치 및 상호작용 정상

#### 성능 최적화:
- ✅ InstancedMesh 기반 건물 렌더링
- ✅ 프레임 안정화 로직 유지
- ✅ 모바일 최적화 유지

### 🎯 결과
- ✅ Scene3D.jsx 500 오류 완전 해결
- ✅ 건물 고스트 렌더링 정상 작동
- ✅ 마을 범위 겹침 자연스러운 병합 효과
- ✅ 에이전트 생성 및 렌더링 정상 작동
- ✅ 모든 3D 렌더링 시스템 정상화
- ✅ 게임 플레이 완전 복구

---

## 2025-01-12 - Scene3D.jsx 리팩토링 및 모듈화

### 📋 작업 개요
**Scene3D.jsx 파일이 너무 길고 복잡해져서 기능별로 분리하여 모듈화**

### 🔧 분리된 모듈들

#### 1. BuildingManager.js
**위치**: `src/components/managers/BuildingManager.js`
**기능**: 건물 렌더링 및 인스턴싱 관리
- 건물 타입별 지오메트리와 재질 정의
- InstancedMesh를 사용한 고성능 건물 렌더링
- 건물 상태에 따른 동적 갱신
- 리소스 정리 및 메모리 관리

#### 2. LabelManager.js
**위치**: `src/components/managers/LabelManager.js`
**기능**: 건설 ETA 라벨 및 시민 이름 라벨 관리
- 건설 중인 건물의 ETA 표시
- 완성된 건물 내 숨겨진 시민들의 이름 표시
- Canvas 기반 텍스트 스프라이트 생성
- 라벨 위치 및 텍스트 동적 업데이트

#### 3. TownRangeManager.js
**위치**: `src/components/managers/TownRangeManager.js`
**기능**: 마을 범위 표시 및 겹침 처리
- 회관별 마을 범위 시각화 (채우기, 테두리, 벽)
- 다중 회관 범위 겹침 감지 및 투명도 조정
- 배치 모드에 따른 범위 색상 변경
- 레벨에 따른 범위 크기 동적 조정

#### 4. InteractionHandler.js
**위치**: `src/components/managers/InteractionHandler.js`
**기능**: 마우스 상호작용 처리
- 클릭/더블클릭/우클릭 이벤트 처리
- 건물 배치 유효성 검사 및 고스트 메쉬 업데이트
- 건물/유닛 선택 및 포커스 이동
- 배경 오브젝트 제거 및 건물 배치 처리

#### 5. SelectionRingManager.js
**위치**: `src/components/managers/SelectionRingManager.js`
**기능**: 선택된 건물/유닛의 링 표시
- 선택된 건물의 반경 기반 링 표시
- 선택된 유닛의 고정 크기 링 표시
- 선택 해제 시 링 숨김 처리
- 링 지오메트리 동적 생성 및 업데이트

### 🔄 Scene3D.jsx 리팩토링

#### 변경 사항:
1. **모듈 import**: 분리된 매니저 클래스들을 import
2. **매니저 초기화**: 각 매니저를 씬에 맞게 초기화
3. **기능 위임**: 기존 인라인 함수들을 매니저 메서드로 대체
4. **상태 관리**: threeRef에 매니저들을 저장하여 접근 가능하도록 설정
5. **정리 로직**: 각 매니저의 dispose 메서드 호출로 리소스 정리

#### 코드 구조 개선:
- **가독성 향상**: 873줄 → 약 300줄로 대폭 단축
- **유지보수성**: 기능별 분리로 수정 시 영향 범위 최소화
- **재사용성**: 각 매니저는 독립적으로 사용 가능
- **확장성**: 새로운 기능 추가 시 해당 매니저만 수정하면 됨

### 📊 시스템 상태

#### 렌더링 시스템:
- ✅ 건물 렌더링 시스템 모듈화 완료
- ✅ 라벨 관리 시스템 모듈화 완료
- ✅ 마을 범위 표시 시스템 모듈화 완료
- ✅ 상호작용 처리 시스템 모듈화 완료
- ✅ 선택 링 표시 시스템 모듈화 완료

#### 성능 최적화:
- ✅ 각 매니저별 독립적인 리소스 관리
- ✅ 메모리 누수 방지를 위한 명시적 dispose 호출
- ✅ 기존 InstancedMesh 최적화 유지

### 🎯 결과
- ✅ Scene3D.jsx 코드 길이 65% 단축 (873줄 → 300줄)
- ✅ 기능별 모듈화로 유지보수성 대폭 향상
- ✅ 각 매니저의 독립적 동작으로 안정성 증대
- ✅ 새로운 기능 추가 시 확장성 확보
- ✅ 기존 기능 완전 보존 및 정상 동작

---

### 📋 작업 개요
**초기 시민을 0명으로 되돌리고 마을 회관 건설 시 시민 생성 문제 해결**

### 🔧 수정 사항

#### 1. 초기 시민 수 조정
**파일**: `src/App.jsx`
- **변경**: 초기 시민 5명 → 0명으로 변경
- **목적**: 마을 회관 건설을 통해서만 시민을 얻도록 게임 플레이 조정

#### 2. 마을 회관 시민 생성 개선
**파일**: `src/game/systems/construction.js`
- **개선사항**:
  - 명시적 `notify()` 호출 추가로 UI 업데이트 보장
  - 디버깅용 console.log 추가로 시민 생성 과정 추적
  - 시민 생성 및 위치 정보 로깅

```javascript
// 추가된 개선사항:
console.log(`마을 회관 건설 완료! 시민 3명 추가`);
console.log(`시민 ${i+1} 생성: 위치 (${ux.toFixed(1)}, ${uz.toFixed(1)})`);
notify(); // 명시적 상태 변경 알림
console.log(`총 시민 수: ${Object.keys(state.units).length}, 인구: ${state.population}`);
```

### 🎯 결과
- ✅ 초기 시민 0명으로 조정
- ✅ 마을 회관 건설 시 시민 3명 생성 로직 개선
- ✅ UI 업데이트 보장을 위한 명시적 notify() 호출
- ✅ 디버깅 정보 추가로 문제 추적 가능

---

## 2025-09-09 - 시민 스탯/스킬/수련치/인벤토리 도입 + 랜덤 스폰

### 📦 추가 파일
1. `src/game/content/units.js`
   - `STAT_KEYS`, `SKILL_KEYS`, `BASE_STATS`, `DEFAULT_INVENTORY()`
   - `rollStats()`, `rollSkills()`, `rollTraining()`
   - `randomName()`, `randomAppearance()`
2. `src/game/factory/citizen.js`
   - `createRandomCitizen(pos)` — 무작위 이름/외형/스탯/스킬/수련치/인벤토리 부여

### 🔧 변경 파일
1. `src/game/systems/construction.js`
   - 회관 완공 시 시민 스폰을 `createRandomCitizen` 기반으로 교체
   - 랜덤 외형/이름/스탯/스킬/수련치가 적용되도록 통합

### ✅ 효과
- 회관 완공마다 고유한 시민이 생성되어 몰입 및 다양성 향상
- `Agents`는 `size/pos/dir`를 반영하여 즉시 시각화

### 👆 시민 선택 및 인스펙터 3단 UI

#### 변경 파일
1. `src/game/state.js`
   - `ui.selectedUnitId` 추가, `setSelectedUnit(id)`/상호배타 로직(건물 선택 해제)
2. `src/components/Scene3D.jsx`
   - 클릭/더블클릭 피킹: 유닛 우선 → 건물, 선택 링(유닛/건물 공용)
3. `src/components/Inspector.jsx`
   - 시민 선택 시 3단 정보 표시(스탯, 스킬/수련 스크롤, 인벤토리 스크롤)

#### 효과
- 시민을 클릭하면 건물과 동일한 방식으로 선택/포커스 가능
- 인스펙터에서 시민 능력치/스킬(재능)/수련치/인벤토리를 직관적으로 확인

### 🏷️ 시민 머리 위 라벨 + 선택 하이라이트

#### 변경 파일
1. `src/components/agents/Agents.jsx`
   - 이름 + 작업 이모지 라벨(Sprite) 추가, 작업 이모지 매핑(건물 타입→이모지)
   - 선택된 유닛에 헤드 주변 할로 스프라이트 표시(아웃라인 유사)

#### 효과
- 각 시민 머리 위에 이름과 현재 배정 작업 상태가 이모지로 표시됨
- 선택 시 시각적 강조로 식별성 향상

### 🖱️ 우클릭 이동(시민)

#### 추가/변경 파일
1. `src/game/systems/movement.js` (신규)
   - `runMovement()` 추가: `unit.moveTo`가 있으면 목표로 보간 이동, 도달 시 idle
2. `src/game/gameLoop.js`
   - 틱 순서에 `runMovement()` 추가
3. `src/game/state.js`
   - `setUnitMoveTarget(unitId, x, z)` 액션 추가
4. `src/components/Scene3D.jsx`
   - 선정 유닛이 있을 때 우클릭 지점으로 이동 명령 발행(컨텍스트 메뉴 차단)

#### 효과
- 시민을 클릭해 선택 후, 땅을 우클릭하면 해당 지점으로 이동합니다.
### 🧠 수련 → practice(0~5) 개편 및 재능 영향

#### 변경 파일
1. `src/game/content/units.js`
   - `rollTraining()` → `rollPractice()`(정수 0~5), `rollSkills()` → `rollTalent()`로 명칭 변경
2. `src/game/factory/citizen.js`
   - 생성 필드: `skills`는 재능, `practice`는 수련치로 채움
3. `src/components/Inspector.jsx`
   - 스킬 목록을 `이름(재능) 수련치` 포맷으로 병합 표시
4. `src/game/systems/production.js`
   - 생산 효율에 수련치(단계당 +4%) 반영, 재능은 소폭 유지(0.4배)

#### 효과
- 수련치가 높을수록 관련 행동의 즉시 효율 증가
- 재능은 수련 속도(향후 성장 로직)와 소폭 효율에 기여

### ✂️ 마을 범위 겹침 클리핑 시스템 (셰이더 기반)

#### 변경 파일
1. `src/components/managers/TownRangeManager.js`
   - 테두리(링)와 벽에 커스텀 셰이더 머티리얼 적용
   - `createClippingEdgeMaterial()`, `createClippingWallMaterial()` 함수로 클리핑 셰이더 생성
   - 겹치는 부분부터 바깥쪽을 실제로 잘라내는 `discard` 처리
   - 각 회관의 중심/반경 정보를 uniforms로 주입하여 다른 회관 원 내부 픽셀 제거
   - 배치 모드 색상 변경도 셰이더 uniforms 기반으로 처리

#### 효과
- 마을 범위가 겹칠 때 겹치는 부분부터 바깥쪽 링이 실제로 잘려서 융합된 것처럼 보임
- 투명도 조절이 아닌 실제 클리핑으로 더 자연스러운 합집합 효과
- 테두리와 벽이 겹치는 구간에서 중복 렌더링되지 않아 깔끔한 시각적 표현

---

## 2025-01-12 - 생산 시스템 대폭 개선

### 📋 작업 개요
**기존 생산 시스템을 시간 기반으로 완전히 재설계하고 시각적 피드백 강화**

### 🔧 주요 변경사항

#### 1. 자원 시스템 단순화
**파일**: `src/game/state.js`
- **변경**: 돌(stone) 자원 완전 제거
- **효과**: 자원 관리 단순화, 게임 밸런스 조정

#### 2. 건물 정의 개선
**파일**: `src/game/content/_defs.sample.js`
- **변경사항**:
  - 모든 건물의 건설 비용에서 돌(stone) 제거
  - 생산품 수량을 정수로 변경 (기존 소수점 → 정수)
  - 각 생산품마다 생산 시간 정의 추가
  - 사냥꾼의 집 → 나무꾼의 집 (나무만 생산)
  - 채집꾼의 집 (허브만 생산)
  - 전사의 집, 마탑, 대장간 (수련치만 획득, crafts/onRaid 제거)

#### 3. 생산 시스템 완전 재설계
**파일**: `src/game/systems/production.js`
- **새로운 기능**:
  - 시민별 개별 생산 진행률 시스템
  - 시민이 숨겨진 순간부터 개별 생산 시작
  - 각 시민의 스탯과 스킬에 따른 개별 생산량
  - 생산 완료 시 정수 단위로 자원 획득
  - 분리된 수련치 상승 시스템 사용
  - 수련 전용 건물 지원 (trains 속성 처리)

#### 3-1. 수련치 상승 시스템 분리
**파일**: `src/game/systems/skillTraining.js` (신규)
- **새로운 기능**:
  - 생산, 전투 등 스킬 사용으로 인한 수련치 상승 관리
  - 재능과 수련치에 따른 확률 계산 시스템
  - 향후 전투 시스템 확장을 위한 확장 가능한 구조

#### 4. 시민 숨김 처리 시스템
**파일**: `src/game/systems/movement.js` (기존 구현 확인)
- **기능**: 시민이 건물에 도착하면 자동으로 숨김 처리
- **효과**: 시민이 건물 내부에서 작업하는 것처럼 시각화

#### 5. 생산 진행률 시각화
**파일**: `src/components/managers/LabelManager.js`
- **새로운 기능**:
  - 건물 상단 이름표에 생산 진행률 바 표시
  - 진행률에 따라 배경색이 차오르는 애니메이션
  - 실시간 생산 상태 시각적 피드백

### 🎯 시스템 상세

#### 생산 진행률 시스템:
- 각 시민별로 개별적인 생산 진행률 관리
- 시민이 숨겨진 순간부터 개별 생산 시작
- 진행률은 고정된 속도로 증가 (효율과 무관)
- 각 시민의 스탯과 스킬에 따른 개별 생산량
- 인구수 배율 적용 (인구 1명당 10% 생산량 증가)
- 생산 완료 시 진행률 리셋 및 자원 획득

#### 재능 기반 수련치 상승:
- 재능 범위: 0~10 (모든 스킬 동일, Admin 가중 제거)
- 초기 수련치 범위: 0~10 (기존 0~100에서 변경)
- 최대 수련치: 500 (기존 100에서 변경)
- 기본 2% 확률로 수련치 상승 (최소 0.1% 확률 보장)
- 재능이 낮으면 기하급수적으로 낮은 확률 (재능 0일 때 거의 불가능)
- 재능이 높을수록 확률 증가 (최대 10% 추가)
- 수련치가 높을수록 확률 감소 (500일 때 90% 감소)
- 수련치 상승 시 생산 효율 향상
- 수련치 상승 시스템을 별도 파일(`skillTraining.js`)로 분리

#### 세금 시스템 개선:
- 기존 시간 기반 세금 시스템 제거
- 마을 회관에서 배치된 시민이 금(gold) 생산 (10초마다 1개)
- 세금도 다른 생산품과 동일한 방식으로 처리
- Admin 스킬을 사용한 생산으로 수련치 상승 가능

#### 시각적 피드백:
- 시민이 건물에 들어가면 이름표에 생산 진행률 표시
- 진행률 바가 녹색으로 차오르며 생산 상태 시각화
- 생산 완료 시 자원 획득 및 수련치 상승 알림

### 📊 시스템 상태

#### 생산 시스템:
- ✅ 시민별 개별 생산 진행률 시스템 완성
- ✅ 시민이 숨겨진 순간부터 개별 생산 시작
- ✅ 각 시민의 스탯과 스킬에 따른 개별 생산량
- ✅ 정수 단위 자원 생산 시스템 완성
- ✅ 재능에 따른 확률적 수련치 상승 시스템 완성
- ✅ 시민 숨김 처리 시스템 정상 작동
- ✅ 생산 진행률 시각화 시스템 완성

#### 게임 밸런스:
- ✅ 자원 시스템 단순화 (돌 제거)
- ✅ 건물별 생산 시간 차별화
- ✅ 생산품 수량 정수화로 명확한 피드백

### 🎯 결과
- ✅ 기존 연속 생산 → 시민별 개별 생산으로 완전 전환
- ✅ 시민이 건물에 들어가서 개별 작업하는 몰입감 증대
- ✅ 각 시민의 능력에 따른 개별 생산량 차별화
- ✅ 생산 진행률 시각화로 게임 상태 명확한 파악
- ✅ 재능 시스템을 통한 시민 성장 요소 강화
- ✅ 자원 관리 단순화로 게임 플레이 집중도 향상

---

## 📅 2024-12-19 - 스킬 및 스탯 시스템 대폭 개선

### 🎯 주요 변경사항

#### 1. 스킬 시스템 개선
**파일**: `src/game/content/units.js`, `src/game/content/_defs.sample.js`, `src/components/managers/BuildingManager.js`
- **변경사항**:
  - Hunting 스킬 → Woodcutting 스킬로 변경
  - 나무꾼의 집이 Woodcutting 스킬 사용
  - BuildingManager에서 hunter → woodcutter 타입 변경 (렌더링 문제 해결)

#### 2. 스탯 성장 시스템 구현
**파일**: `src/game/systems/skillTraining.js`
- **새로운 기능**:
  - 수련치 상승 시 관련 스탯 자동 증가
  - 스킬별 스탯 증가 매핑:
    - 농사(Farming): 체력 +2
    - 벌목(Woodcutting): 힘 +1, 체력 +1
    - 채집(Gathering): 민첩 +2
    - 광부(Mining): 힘 +1, 체력 +1
    - 전사(Sword): 힘 +2, 민첩 +1, 체력 +1
    - 마법(Magic): 지력 +2
    - 대장장이(Smithing): 힘 +1, 체력 +1
    - 행정(Admin): 지력 +1, 민첩 +1
  - 수련치 10의 배수마다 스탯 증가
  - HP/MP 자동 재계산

#### 3. 생산 효율 개선
**파일**: `src/game/systems/production.js`
- **새로운 기능**:
  - 스킬별 관련 스탯 보너스 추가
  - 각 스킬에 맞는 스탯이 생산 효율에 더 큰 영향
  - 예: 농사는 체력, 벌목은 힘+체력, 채집은 민첩

#### 4. 이동 속도 개선
**파일**: `src/game/systems/movement.js`
- **변경사항**:
  - 민첩(AGI) 스탯이 이동 속도에 더 강하게 영향
  - 기본 속도 0.8 + 민첩*0.04

#### 5. 전투 스탯 시스템 구현
**파일**: `src/game/factory/citizen.js`, `src/game/systems/skillTraining.js`, `src/components/Inspector.jsx`
- **새로운 기능**:
  - 공격력: 힘*2 + 민첩*0.5
  - 방어력: 체력*1.5 + 민첩*0.5
  - 마법 공격력: 지력*2
  - 스탯 증가 시 전투 스탯 자동 재계산
  - Inspector에서 전투 스탯 표시

### 🎯 결과
- ✅ 스킬과 스탯의 연관성 강화로 성장 요소 증대
- ✅ 각 스킬별 특화된 스탯 성장으로 차별화된 시민 육성
- ✅ 생산 효율에 스탯 영향 추가로 전략적 요소 강화
- ✅ 민첩 스탯의 실질적 효과로 스탯 밸런스 개선
- ✅ 전투 시스템 기반 마련으로 향후 확장 가능

---

## 📅 2024-12-19 - MP/HP 최대치 도입 및 계산 시스템 개선

### 🎯 주요 변경사항

#### 1. MP/HP 계산 함수 모듈화
**파일**: `src/game/factory/citizen.js`
- **변경사항**:
  - `calculateMP(int)` 함수: 지력 스탯 기반 MP 계산
  - `calculateHP(vit)` 함수: 체력 스탯 기반 HP 계산
  - `calculateCombatStats(stats)` 함수: 전투 스탯 계산
  - 시민 생성 시 `hpMax/mpMax` 계산 후 현재치를 최대치로 초기화

#### 2. 스탯 증가 시 최대치/현재치 재계산
**파일**: `src/game/systems/skillTraining.js`
- **변경사항**:
  - `skillTraining.js`에서 VIT/INT 상승 시 `hpMax/mpMax` 갱신
  - 현재 `hp/mp`는 최대치를 초과하지 않도록 캡 처리(최초 없음 시 최대치로 초기화)
  - 전투 스탯은 함수 호출로 일관 재계산

#### 3. 시스템/UI 개선
- **변경사항**:
  - `Inspector.jsx`의 기본 정보 영역에서 HP/MP를 `현재/최대` 형식으로 표시
- **효과**:
  - MP/HP가 INT/VIT 변화에 따라 동적으로 변동(최대치 포함)
  - 전투 스탯이 모든 스탯 변화에 따라 자동 재계산
  - 코드 모듈화로 유지보수성 향상

### 🎯 결과
- ✅ MP가 INT 스탯에 따라 동적으로 변동
- ✅ HP가 VIT 스탯에 따라 동적으로 변동
- ✅ 전투 스탯이 모든 스탯 변화에 따라 자동 재계산
- ✅ 코드 모듈화로 유지보수성 향상

---

### 🎯 주요 변경사항

#### 1. 시민 인스펙터 레이아웃 재구성
**파일**: `src/components/Inspector.jsx`
- **변경사항**:
  - 기존 3칸 레이아웃을 유지하되 첫 번째 칸에 모든 기본 정보 통합
  - 첫 번째 칸: 레벨, HP, MP, 스탯(STR/AGI/VIT/INT), 전투스탯(공격력/방어력/마법공격)
  - 두 번째 칸: 스킬(재능) 및 수련치 정보
  - 세 번째 칸: 인벤토리 정보
  - 상단 중복 정보 제거 (레벨/HP/MP는 첫 번째 칸에만 표시)

#### 2. 정보 표시 최적화
- **효과**:
  - 시민의 모든 핵심 정보를 한 눈에 파악 가능
  - 공간 효율성 향상으로 더 많은 정보 표시
  - 시각적 일관성 개선

### 🎯 결과
- ✅ 시민 인스펙터의 정보 밀도 향상
- ✅ 사용자 경험 개선 (한 번에 모든 정보 확인)
- ✅ UI 공간 효율성 최적화

---

### 🎯 주요 변경사항

#### 1. 건물 경험치 시스템 개선
**파일**: `src/game/systems/production.js`, `src/game/systems/buildingXP.js`
- **변경사항**:
  - 패시브 경험치 증가 제거 (기존 0.2/틱)
  - 생산 완료 시에만 경험치 증가 (생산량 × 2)
  - 수련 완료 시 고정 경험치 증가 (5점)
  - 건물 레벨업은 생산/수련 활동에만 의존

#### 2. 명성 시스템 개선
**파일**: `src/game/systems/reputation.js`
- **변경사항**:
  - 기존 인구 증가 요구치 시스템 제거
  - 건물 레벨 기반 명성 증가 (레벨당 0.1명성/틱)
  - 더 높은 레벨의 건물일수록 더 많은 명성 획득

#### 3. 인구 시스템 완전 재설계
**파일**: `src/game/state.js`, `src/game/systems/populationGrowth.js` (신규)
- **변경사항**:
  - 최대 인구(popCap) 개념 완전 제거
  - 명성 기반 동적 인구 증가 시스템 구현
  - 명성에 비해 인구가 적으면 높은 확률로 인구 증가
  - 명성에 비해 인구가 많으면 낮은 확률로 인구 증가
  - 새로운 시민은 랜덤한 마을 회관 주변에 생성

#### 4. 게임 루프 업데이트
**파일**: `src/game/gameLoop.js`
- **변경사항**:
  - 새로운 인구 증가 시스템 통합
  - 시스템 실행 순서 최적화

### 🎯 결과
- ✅ 건물 경험치가 실제 활동에만 의존하여 의미 있는 성장
- ✅ 명성이 건물 발전과 직접적으로 연결된 명확한 시스템
- ✅ 인구 제한 없는 자연스러운 성장 시스템
- ✅ 명성과 인구의 균형잡힌 관계로 게임 밸런스 개선
- ✅ 마을 회관 중심의 인구 증가로 전략적 요소 강화

---

## 📅 2025-01-12 - 우상단 메인 메뉴 시스템 구현

### 🎯 주요 변경사항

#### 1. MainMenu 컴포넌트 생성
**파일**: `src/components/MainMenu.jsx` (신규)
- **기능**: 우상단에 건축🏗️, 건물🏠, 시민👥, 외교🤝 버튼으로 구성된 탭 메뉴 시스템
- **구조**: 각 버튼 클릭 시 해당 탭의 박스가 나타나는 시스템
- **상태 관리**: React useState를 사용한 탭 활성화 상태 관리

#### 2. 탭별 기능 구현
- **건축 탭**: 기존 BuildMenu와 동일한 건물 목록 및 건설 비용 표시, 클릭 시 건설 모드 진입
- **건물 탭**: 현재 건물 목록 표시 (이름, 레벨, HP), 클릭 시 인스펙터에서 건물 정보 확인
- **시민 탭**: 현재 시민 목록 표시 (이름, 레벨, HP), 클릭 시 인스펙터에서 시민 정보 확인
- **외교 탭**: 미구현 상태 메시지 표시

#### 3. App.jsx 통합
**파일**: `src/App.jsx`
- **변경사항**: 기존 BuildMenu 컴포넌트를 MainMenu로 교체
- **효과**: 새로운 통합 메뉴 시스템으로 UI 일관성 향상

#### 4. README.md 업데이트
**파일**: `README.md`
- **변경사항**: MainMenu 기능 설명 추가, 프로젝트 구조 업데이트
- **효과**: 문서와 실제 구현의 일치성 확보

### 🎯 결과
- ✅ 우상단에 통합된 탭 메뉴 시스템 완성
- ✅ 건축, 건물, 시민, 외교 기능을 하나의 인터페이스로 통합
- ✅ 각 탭에서 클릭 시 기존 인스펙터 시스템과 연동
- ✅ 사용자 경험 향상 및 UI 일관성 개선
- ✅ 향후 외교 기능 확장을 위한 구조 마련
