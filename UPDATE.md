## 🏷️ 몬스터 라벨 및 이름 표시 개선 (2024-12-19)

### 📋 작업 요약
오크 군락지와 라벨이 겹치는 문제와 오크 생성 시 유닛 이름이 고블린으로 표시되는 문제를 해결했습니다.

### 🔧 주요 변경사항

#### 1. 몬스터 라벨 이름 표시 개선
- `EntityRenderer.jsx`에서 하드코딩된 "고블린" 라벨을 실제 몬스터 이름(`m.name`)으로 변경
- 오크는 "오크", 고블린은 "고블린"으로 올바르게 표시

#### 2. 오크 라벨 위치 조정
- 오크는 크기가 더 크므로(`size: 1.2`) 라벨 높이를 `2.0*monsterSize`로 조정
- 고블린은 기존대로 `1.5*monsterSize` 유지
- 오크 군락지와 라벨 겹침 문제 해결

#### 3. 몬스터 생산 디버깅 로그 개선
- `monsterNestManager.js`에서 생성된 몬스터의 실제 이름을 로그에 포함
- 오크 생산 시 "이름: 오크" 확인 가능

### 🔄 수정된 파일
- `src/components/rendering/EntityRenderer.jsx` - 몬스터 라벨 이름 및 위치 개선
- `src/game/systems/monsterNestManager.js` - 몬스터 생산 로그에 이름 추가

### 🎯 결과
- 오크와 고블린이 각각 올바른 이름으로 표시
- 오크 라벨이 군락지와 겹치지 않음
- 몬스터 생산 과정의 디버깅 정보 개선

---

## 🏠 HUD 건물목록 개선 및 몬스터 스폰 디버깅 (2024-12-19)

### 📋 작업 요약
HUD의 건물목록에서 적 팀 건물을 숨기고, 각 몬스터 군락에서 올바른 몬스터가 스폰되는지 확인하기 위한 디버깅 로그를 추가했습니다.

### 🔧 주요 변경사항

#### 1. HUD 건물목록에서 적 팀 건물 숨기기
- `MainMenu.jsx`의 `renderBuildingsTab` 함수 수정
- `building.team === 0` 필터를 추가하여 플레이어 팀 건물만 표시
- 적 팀(팀 1, 팀 2) 건물은 HUD에서 보이지 않음

#### 2. 몬스터 스폰 디버깅 로그 추가
- `monsterNestManager.js`의 `produceMonster` 함수에 디버깅 로그 추가
- 군락지 타입과 ID를 로그로 출력하여 올바른 몬스터가 스폰되는지 확인
- 각 몬스터 타입별 생산 로그 유지

### 🔄 수정된 파일
- `src/components/MainMenu.jsx` - 건물목록에서 적 팀 건물 숨기기
- `src/game/systems/monsterNestManager.js` - 몬스터 스폰 디버깅 로그 추가

### 🎯 결과
- HUD에서 플레이어 소유 건물만 표시
- 몬스터 스폰 과정의 디버깅 정보 제공
- 각 군락지에서 올바른 몬스터 타입이 스폰되는지 확인 가능

---

## 🏃 몬스터 렌더링 이동 시스템 개선 (2024-12-19)

### 📋 작업 요약
몬스터의 렌더링에서 시민과 다른 이동 처리를 사용하여 급격하게 움직이는 문제를 해결했습니다.

### 🔧 주요 변경사항

#### 1. 몬스터의 급격한 이동 문제 원인 분석
- **시민**: 목표가 있을 때 예측 이동을 사용하여 부드럽게 이동
- **몬스터**: 단순한 스무딩만 사용하여 급격하게 이동 (문제점)

#### 2. 몬스터 렌더링 이동 시스템 개선
- 몬스터도 시민과 동일한 예측 이동 방식 사용
- 목표가 있을 때: `spd * dtRender` 속도로 부드럽게 이동
- 목표가 없을 때: 현재 위치로 천천히 수렴

#### 3. 시민과 동일한 이동 로직 적용
- AGI 기반 속도 계산: `spd = 2.2 * (0.9 + AGI*0.02)`
- 부드러운 지상 높이 수렴: `0.15` 비율
- 정지 시 위치 수렴: `0.28` 비율

### 🔄 수정된 파일
- `src/components/rendering/EntityRenderer.jsx` - 몬스터 렌더링 이동 시스템 개선

### 🎯 결과
- 몬스터가 시민과 동일한 부드러운 이동 패턴
- 순식간에 가속하는 현상 해결
- 더 자연스럽고 일관된 시각적 이동

---

## 🏃 몬스터 이동 시스템 개선 (2024-12-19)

### 📋 작업 요약
몬스터의 이동 시스템을 시민과 동일하게 개선하여 목표 변경 시 즉시 새로운 목표로 이동하도록 수정했습니다.

### 🔧 주요 변경사항

#### 1. 몬스터와 시민의 이동 시스템 차이점 분석
- **시민**: 목표 변경 시 즉시 새로운 목표로 이동
- **몬스터**: 이전 목표에 도달한 후에야 새로운 목표로 이동 (문제점)

#### 2. 몬스터 이동 시스템 개선
- `isAtTarget` 함수 제거 (더 이상 사용하지 않음)
- 목표 도달 시 즉시 새로운 목표 설정하도록 수정
- 시민과 동일한 즉시 반응 방식으로 변경

#### 3. 이동 로직 단순화
- 목표가 없을 때만 새로운 목표 설정
- 목표 도달 시 즉시 새로운 목표 설정
- 랜덤 목표 변경 확률은 유지 (10%)

### 🔄 수정된 파일
- `src/game/systems/simpleMonsterSystem.js` - 몬스터 이동 시스템 개선

### 🎯 결과
- 몬스터가 시민과 동일한 방식으로 즉시 반응
- 목표 변경 시 순식간에 도착하는 현상 해결
- 더 자연스럽고 일관된 이동 패턴

---

## 🏃 몬스터 이동 속도 조정 (2024-12-19)

### 📋 작업 요약
몬스터의 이동 속도가 너무 빨라서 AGI 스탯을 조정하여 더 현실적인 속도로 변경했습니다.

### 🔧 주요 변경사항

#### 1. 몬스터 이동 속도 시스템 확인
- 몬스터는 이미 시민과 동일한 이동 시스템(`moveEntity`)을 사용
- AGI에 따른 속도 계산이 이미 적용되어 있음: `speed = speedBase * (0.8 + agility * 0.04)`
- 문제는 몬스터의 AGI 스탯이 너무 높아서 발생

#### 2. 고블린 AGI 스탯 조정
- 기존: AGI 4~9
- 변경: AGI 2~5 (속도 조정을 위해 낮춤)

#### 3. 오크 AGI 스탯 조정
- 기존: AGI 3~8
- 변경: AGI 2~5 (속도 조정을 위해 낮춤)

### 🔄 수정된 파일
- `src/game/content/goblins.js` - 고블린 AGI 스탯 범위 조정
- `src/game/content/orcs.js` - 오크 AGI 스탯 범위 조정

### 🎯 결과
- 몬스터들이 시민과 비슷한 속도로 이동
- AGI에 따른 개별 속도 차이는 유지
- 더 현실적이고 균형잡힌 게임플레이

---

## 🏗️ 고블린 건물 타입 명확화 (2024-12-19)

### 📋 작업 요약
고블린의 건물 타입을 `monster_den`에서 `goblin_den`으로 변경하여 더 명확한 타입 구분을 구현했습니다.

### 🔧 주요 변경사항

#### 1. 건물 정의 타입 변경
- `_defs.sample.js`에서 `monster_den`을 `goblin_den`으로 변경
- 고블린 군락의 이름을 "고블린 군락"으로 명확히 표기

#### 2. 렌더링 시스템 타입 변경
- `BuildingManager.js`에서 `monster_den`을 `goblin_den`으로 변경
- `BlueprintManager.js`에서 `monster_den`을 `goblin_den`으로 변경

#### 3. 몬스터 군락지 관리 시스템 변경
- `monsterNestManager.js`에서 기본 타입을 `goblin_den`으로 변경
- 로그 메시지를 "고블린 군락지"로 명확히 표기

#### 4. 초기화 시스템 변경
- `state.js`에서 초기 고블린 군락 생성 시 `goblin_den` 타입 사용

### 🔄 수정된 파일
- `src/game/content/_defs.sample.js` - 건물 정의 타입 변경
- `src/game/systems/monsterNestManager.js` - 군락지 관리 시스템 변경
- `src/components/managers/BuildingManager.js` - 건물 렌더링 타입 변경
- `src/components/managers/BlueprintManager.js` - 청사진 렌더링 타입 변경
- `src/game/state.js` - 초기화 시스템 변경

### 🎯 결과
- 고블린과 오크가 각각 `goblin_den`과 `orc_den` 타입으로 명확히 구분
- 건물 렌더링과 청사진 시스템에서 일관된 타입 사용
- 더 직관적이고 명확한 건물 타입 구분

---

## 🏗️ 초기 몬스터 군락지 배치 개선 (2024-12-19)

### 📋 작업 요약
게임 시작 시 고블린 군락 하나와 오크 군락 하나를 각각 배치하도록 초기화 시스템을 개선했습니다.

### 🔧 주요 변경사항

#### 1. 초기 몬스터 군락지 배치 확장
- `state.js`의 `initializeMonsterSystem` 함수 수정
- 기존: 고블린 군락 1개만 생성
- 변경: 고블린 군락 1개 + 오크 군락 1개 생성

#### 2. 군락지 타입별 생성
- 고블린 군락: `monster_den` 타입, 팀 1
- 오크 군락: `orc_den` 타입, 팀 2
- 각각 마을 중심에서 40~60 거리의 랜덤 위치에 배치

### 🔄 수정된 파일
- `src/game/state.js` - 초기 몬스터 시스템 초기화 로직 개선

### 🎯 결과
- 게임 시작 시 고블린과 오크가 각각 독립적인 군락지에서 생산
- 두 종족이 서로 다른 팀으로 운영되어 더 다양한 전투 상황 제공
- 각 군락지에서 해당 종족의 몬스터가 자동으로 생산

---

## 🏗️ 몬스터 타입 구분 시스템 개선 (2024-12-19)

### 📋 작업 요약
몬스터 타입 구분을 `monster`/`orc`에서 `goblin`/`orc`로 변경하여 더 명확한 타입 구분을 구현했습니다.

### 🔧 주요 변경사항

#### 1. 고블린 타입 명확화
- 고블린의 `type` 속성을 `goblin`으로 명확히 구분
- 기존 `monster` 타입에서 `goblin` 타입으로 변경

#### 2. 건물 생산 정의 수정
- `_defs.sample.js`에서 `monster_den`의 생산을 `monster`에서 `goblin`으로 변경
- 이제 고블린 군락은 `goblin` 자원을 생산

#### 3. 생산 시스템 타입 구분 개선
- `production.js`에서 `goblin`과 `orc` 자원 타입으로 명확히 구분
- 생산 진행률과 생산량 계산에서 `goblin`/`orc` 타입 처리

### 🔄 수정된 파일
- `src/game/content/_defs.sample.js` - 고블린 생산 타입 변경
- `src/game/systems/production.js` - 생산 시스템 타입 구분 개선

### 🎯 결과
- 고블린과 오크가 각각 `goblin`과 `orc` 타입으로 명확히 구분
- 생산 시스템에서 더 직관적인 타입 구분
- 향후 다른 몬스터 타입 추가 시 더 명확한 구조

---

## 🏗️ 오크 시스템 추가 및 몬스터 시스템 확장 (2024-12-19)

### 📋 작업 요약
기존 몬스터 군락(고블린)을 유지하면서 오크 군락과 오크를 별도 팀으로 추가하여 몬스터 시스템을 확장했습니다.

### 🔧 주요 변경사항

#### 1. 오크 콘텐츠 정의
- `content/orcs.js` 새로 생성
- `createRandomOrc` 함수로 랜덤 스탯 오크 생성
- 고블린보다 강한 스탯 (STR 6~12, HP 60~100, 공격력 6~12)
- 팀 2로 설정하여 고블린(팀 1)과 구분

#### 2. 오크 군락 건물 추가
- `_defs.sample.js`에 `orc_den` 건물 정의 추가
- HP 350, 건설 시간 4초, 비용 증가
- 12초마다 오크 1마리 생산

#### 3. MonsterNestManager 확장
- `createNest` 함수에 `nestType` 매개변수 추가
- `produceMonster` 함수로 고블린/오크 통합 생산
- 오크 홈 군락지 추적 지원

#### 4. 몬스터 AI 시스템 확장
- `simpleMonsterSystem.js`에 오크 홈 군락지 추적 추가
- `setOrcHomeNest`, `getOrcHomeNest` 함수 추가
- `setRandomTarget` 함수에서 몬스터 타입별 홈 군락지 처리

#### 5. 생산 시스템 확장
- `production.js`에서 `orc` 자원 생산 지원
- 몬스터 생산 진행률과 생산량을 고정으로 유지

### 📁 새로 생성된 파일
- `src/game/content/orcs.js` - 오크 정의 및 랜덤 생성

### 🔄 수정된 파일
- `src/game/content/_defs.sample.js` - 오크 군락 건물 정의 추가
- `src/game/systems/monsterNestManager.js` - 오크 지원 추가
- `src/game/systems/simpleMonsterSystem.js` - 오크 AI 지원
- `src/game/systems/production.js` - 오크 생산 지원

### 🎯 결과
- 고블린(팀 1)과 오크(팀 2)가 별도 팀으로 운영
- 각각 독립적인 군락지에서 생산
- 각각 독립적인 홈 군락지 주변에서 배회
- 확장 가능한 구조로 향후 다른 몬스터 타입 추가 용이

---

## 🏗️ 몬스터 군락지 관리 시스템 분리 및 최적화 (2024-12-19)

### 📋 작업 요약
몬스터 군락지 관리를 별도 파일로 분리하고, 라벨 겹침 문제를 해결하여 확장 가능한 구조로 개선했습니다.

### 🔧 주요 변경사항

#### 1. 몬스터 군락지 관리 시스템 분리
- `systems/monsterNestManager.js` 새로 생성
- `MonsterNestManager` 클래스로 군락지 생성, 관리, 제거 기능 구현
- 가상 시민 생성 및 관리 로직을 별도 클래스로 이동
- 팀별 군락지 관리 기능 추가

#### 2. 코드 구조 개선
- `state.js`에서 몬스터 군락지 초기화 로직 제거
- `production.js`에서 새로운 매니저 사용
- 동적 import를 사용하여 순환 참조 방지
- 확장 가능한 구조로 설계 (다른 몬스터나 산적 추가 준비)

#### 3. 라벨 겹침 문제 해결
- `EntityRenderer.jsx`에서 라벨 위치를 더 높게 조정
- 시민 라벨: 0.9 → 1.5 배율로 상승
- 몬스터 라벨: 0.9 → 1.5 배율로 상승
- 건물과 라벨이 겹치지 않도록 개선

#### 4. MonsterNestManager 주요 기능
- `createNest()`: 군락지 생성
- `createVirtualWorker()`: 가상 시민 생성
- `produceGoblin()`: 고블린 생산
- `removeNest()`: 군락지 제거
- `createRandomNest()`: 랜덤 위치에 군락지 생성
- `getNestsByTeam()`: 팀별 군락지 조회

### 🎯 결과
- **모듈화**: 몬스터 군락지 관리가 독립적인 모듈로 분리
- **확장성**: 다른 몬스터 종족이나 산적 추가 시 쉽게 확장 가능
- **유지보수성**: 코드가 더 명확하게 분리되어 유지보수 용이
- **시각적 개선**: 라벨과 건물이 겹치지 않아 더 깔끔한 UI

---

## 🧌 몬스터 군락지 자동 생산 및 고블린 활동성 향상 (2024-12-19)

### 📋 작업 요약
몬스터 군락지가 시민 배치 없이도 자동으로 고블린을 생산하고, 고블린이 더 활발하게 움직이도록 개선했습니다.

### 🔧 주요 변경사항

#### 1. 몬스터 군락지 자동 생산 시스템
- `state.js`의 `initializeMonsterSystem`에서 가상 시민 생성
- 가상 시민 "고블린 군락"을 몬스터 군락지에 자동 배치
- 몬스터 번식 스킬과 수련치를 최대로 설정하여 효율적인 생산
- 숨김 상태로 건물에 배치되어 시각적으로는 보이지 않음

#### 2. 고블린 활동성 향상
- `simpleMonsterSystem.js`에서 도달 판정 거리를 2미터에서 1미터로 단축
- 군락지 주변 배회 반경을 8미터에서 5미터로 축소
- 10% 확률로 랜덤하게 목표 변경하여 더 자주 움직임
- 홈이 없는 고블린의 배회 반경도 20~50에서 15~35로 축소

#### 3. 생산 시스템 활용
- 기존 `production.js`의 생산 시스템을 그대로 활용
- 몬스터 군락지 정의에서 10초마다 고블린 1마리 생산
- 가상 시민이 몬스터 번식 스킬을 사용하여 생산 진행

### 🎯 결과
- **자동화**: 몬스터 군락지가 별도 시민 배치 없이 자동으로 고블린 생산
- **활동성**: 고블린이 더 자주 움직여 생동감 있는 게임플레이 제공
- **효율성**: 기존 생산 시스템을 재활용하여 코드 중복 없이 구현
- **현실성**: 고블린이 군락지 주변에서 더 집중적으로 활동하는 현실적인 패턴

---

## 🧌 고블린 시스템 고도화 및 팀 기반 건물 관리 (2024-12-19)

### 📋 작업 요약
고블린 시스템을 더욱 현실적이고 전략적으로 만들기 위해 여러 기능을 추가하고 개선했습니다.

### 🔧 주요 변경사항

#### 1. 게임 시작 시 랜덤 고블린 스폰 제거
- `state.js`의 `initializeMonsterSystem`에서 초기 고블린 2마리 제거
- 이제 고블린은 오직 몬스터 군락지에서만 생산됨

#### 2. 건물 팀 시스템 도입
- 모든 건물에 `team` 속성 추가
- 플레이어 건물: `team: 0`
- 몬스터 군락지: `team: 1`
- 건물 생성 시 자동으로 팀 속성 할당

#### 3. 팀 기반 건물 상호작용 제한
- `Inspector.jsx`에서 건물의 팀 확인
- 우리팀이 아닌 건물 클릭 시:
  - 이름 변경, 철거, 이동, 시민 배치 버튼 숨김
  - "적의 건물입니다" 메시지 표시
  - 건물 이름과 기본 정보만 표시

#### 4. 고블린 정의 파일 생성
- `content/goblins.js` 새로 생성
- 고블린 기본 스탯 범위 정의:
  - STR: 3~8, AGI: 4~9, VIT: 3~7, INT: 2~6
- 고블린 능력치 범위 정의:
  - 공격력: 4~8, 방어력: 2~5, 체력: 40~70, 속도: 1.2~2.0
- `createRandomGoblin()` 함수로 랜덤 스탯 고블린 생성

#### 5. 랜덤 스탯 고블린 생산
- `production.js`에서 `createRandomGoblin()` 함수 사용
- 몬스터 군락지에서 생산되는 고블린마다 다른 스탯 보유
- 생산 시 고블린의 스탯 정보 로그 출력

#### 6. 고블린 군락지 주변 배회 시스템
- `simpleMonsterSystem.js`에 홈 군락지 추적 시스템 추가
- 고블린이 태어난 군락지를 홈으로 인식
- 홈 군락지 주변 8미터 반경에서만 배회
- 홈이 없는 고블린은 마을 중심에서 배회

### 🎯 결과
- **전략적 깊이**: 고블린이 군락지 주변에서만 활동하여 영역 방어 개념 도입
- **다양성**: 각 고블린마다 다른 스탯으로 개성 있는 몬스터 구현
- **게임플레이 명확성**: 팀 시스템으로 적과 아군 구분 명확화
- **현실성**: 고블린이 홈베이스 주변에서만 활동하는 현실적인 행동 패턴

---

## 🧌 몬스터 시스템 통합 및 간소화 (2024-12-19)

### 📋 작업 요약
기존에 분리되어 있던 몬스터 시스템을 시민 시스템과 완전히 통합하여 동일한 렌더러, 애니메이션, 이동 시스템을 사용하도록 리팩토링했습니다.

### 🗑️ 삭제된 파일들
- `src/components/managers/MonsterManager.js` - 몬스터 전용 렌더링 매니저
- `src/components/animations/MonsterAnimations.js` - 몬스터 전용 애니메이션
- `src/game/systems/monsterAI.js` - 복잡한 몬스터 AI 시스템
- `src/game/systems/monsterSystem.js` - 기존 몬스터 시스템 메인
- `src/game/systems/monsterNests.js` - 몬스터 군락 시스템
- `src/game/content/monsters.js` - 몬스터 정의 파일

### ✨ 새로 생성된 파일
- `src/game/systems/simpleMonsterSystem.js` - 간소화된 몬스터 시스템 (랜덤 이동)

### 🔧 주요 변경사항

#### 1. 렌더링 통합 (`EntityRenderer.jsx`)
- 몬스터와 시민이 동일한 `InstancedMesh` 사용
- 몬스터는 초록색 고블린으로 통일
- 몬스터 라벨을 "고블린"으로 표시
- 시민과 동일한 애니메이션 함수 사용 (`computeWalkSwing`)

#### 2. 데이터 구조 통합
- 몬스터가 시민과 동일한 데이터 구조 사용:
  - `pos` (위치), `dir` (방향), `size` (크기)
  - `moveTo` (이동 목표), `state` (상태)
  - `appearance` (외형), `team` (팀 소속)

#### 3. 이동 시스템 통합 (`simpleMonsterSystem.js`)
- 시민과 동일한 `moveEntity` 함수 사용
- 랜덤 좌표로 이동하는 간단한 AI
- 시민과 동일한 이동 속도 및 스무딩 적용

#### 4. 팀 시스템 도입
- `team: 0` - 플레이어 소속 (클릭/조종 가능)
- `team: 1, 2, 3` - 몬스터 종족별 구분
- `InteractionHandler.js`에서 팀 0만 선택 가능하도록 제한

#### 5. 몬스터 생산 시스템 (`production.js`)
- 몬스터 군락을 일반 생산 건물로 변경
- 시민이 일해서 몬스터를 생산하는 시스템
- 생산된 몬스터는 시민과 동일한 데이터 구조 사용

#### 6. 게임 시작 시 몬스터 군락지 설치 (`state.js`)
- 랜덤한 위치에 몬스터 군락지 자동 설치
- 기존 몬스터 2마리와 함께 초기화

### 🎯 결과
- **성능 향상**: 복잡한 몬스터 AI 제거로 성능 개선
- **코드 통합**: 몬스터와 시민이 동일한 시스템 사용
- **시각적 일관성**: 모든 엔티티가 동일한 메쉬와 애니메이션 사용
- **게임플레이 명확성**: 팀 시스템으로 플레이어와 적 구분 명확화

---

## 2025-01-27 - 🏗️ 렌더링 시스템 완전 재구조화 - 역할 분리 및 파일 정리

### 🔧 수정 내용
**중복되고 혼란스러운 렌더러 파일들을 명확한 역할로 재구조화**

### 📋 **기존 문제점**

#### ❌ **파일 역할 중복 및 혼란**
- `Agents.jsx` - 구버전 시민 렌더러 (InstancedMesh)
- `UnifiedCitizenRenderer.jsx` - 통합 엔티티 렌더러 (InstancedMesh)
- `UnifiedMonsterRenderer.js` - 몬스터 전용 렌더러 (EntityRenderManager 사용)
- `EntityRenderManager.js` - 개별 메쉬 방식 (성능 낮음)

#### ⚠️ **중복 코드 및 성능 문제**
- 동일한 기능의 라벨/할로 생성 함수가 여러 파일에 산재
- 성능 낮은 개별 메쉬 방식과 고성능 InstancedMesh 방식 혼재
- 몬스터와 시민이 서로 다른 렌더링 시스템 사용으로 일관성 부족

### 🎯 **새로운 구조**

```
src/components/
├── rendering/
│   ├── EntityRenderer.jsx     # 📦 통합 엔티티 렌더러 (InstancedMesh)
│   └── RenderingUtils.js      # 🛠️ 공통 렌더링 유틸리티
└── agents/
    ├── behaviors.js           # 🎭 애니메이션 동작 (유지)
    └── Agents.jsx.backup      # 💾 백업 (참고용)
```

### 📊 **역할 분배**

#### 1. **`EntityRenderer.jsx`** - 🎯 **메인 렌더러**
- **InstancedMesh 방식**으로 시민 + 몬스터 + 군락지 통합 렌더링
- **최고 성능**: 수백 개 엔티티를 6개 draw call로 렌더링
- **지상 높이 계산**: `getGroundHeight()` 적용으로 부드러운 지형 추종
- **통합 애니메이션**: 시민과 몬스터 모두 부드러운 움직임

#### 2. **`RenderingUtils.js`** - 🛠️ **공통 유틸리티**
- **라벨 생성**: `createLabelSprite()` - 이름 + 작업 이모지
- **선택 할로**: `createSelectionHalo()` - 선택된 엔티티 강조
- **군락지 메쉬**: `createForestNestMesh()`, `createDesertNestMesh()`
- **색상 관리**: `getMonsterColor()`, `getColorFromAppearance()`
- **작업 이모지**: `getUnitJobEmoji()` - 시민 직업 표시

#### 3. **`behaviors.js`** - 🎭 **순수 애니메이션**
- `computeBodyBounce()` - 걷기 시 몸체 상하 움직임
- `computeWalkSwing()` - 팔 흔들기 및 발걸음 애니메이션

### 🚀 **성능 및 기능 향상**

#### **통합 렌더링 성능**
- **Draw Calls**: 시민 6개 + 몬스터 6개 = 총 12개
- **GPU 최적화**: InstancedMesh로 수백 개 엔티티 효율 렌더링
- **메모리 효율**: 공유 geometry와 material로 최소 메모리 사용

#### **부드러운 움직임**
- **지상 높이 적용**: 시민이 이동 시작할 때 뜨는 문제 완전 해결
- **예측 이동**: 렌더 프레임마다 부드럽게 목표로 전진
- **방향 스무딩**: 0.15 계수로 자연스러운 회전
- **통합 애니메이션**: 시민과 몬스터 동일한 품질의 부드러운 움직임

#### **코드 품질**
- **중복 제거**: 공통 함수들을 RenderingUtils로 통합
- **역할 분리**: 렌더링과 애니메이션 로직 명확히 분리
- **유지보수성**: 단일 렌더러로 모든 엔티티 관리

### 🗂️ **파일 변경사항**

#### **제거된 파일** ❌
- `src/components/agents/UnifiedCitizenRenderer.jsx` → `EntityRenderer.jsx`로 통합
- `src/components/managers/UnifiedMonsterRenderer.js` → 중복 제거
- `src/components/managers/EntityRenderManager.js` → 성능 낮아 제거
- `src/components/agents/Agents.jsx` → `Agents.jsx.backup`으로 백업

#### **새로 생성된 파일** ✅
- `src/components/rendering/EntityRenderer.jsx` - 통합 엔티티 렌더러
- `src/components/rendering/RenderingUtils.js` - 공통 유틸리티

#### **수정된 파일** 🔄
- `src/components/Scene3D.jsx` - 새로운 EntityRenderer 사용

### 🎯 **결과**
- ✅ **완벽한 통합**: 시민, 몬스터, 군락지 모두 하나의 렌더러에서 처리
- ✅ **최고 성능**: InstancedMesh 방식으로 최적화된 렌더링
- ✅ **부드러운 움직임**: 지상 높이 적용 및 예측 이동으로 자연스러운 애니메이션
- ✅ **코드 품질**: 중복 제거 및 명확한 역할 분리
- ✅ **확장성**: 새로운 엔티티 타입 추가 용이

---

## 2025-01-27 - 🚀 시민 렌더링 성능 복원 - InstancedMesh 방식으로 롤백

### 🔧 수정 내용
**시민의 부드러운 이동을 위해 InstancedMesh 기반 렌더링으로 복원**

### 📋 문제 진단 및 해결

#### 🐛 **이동 끊김 문제 원인**
- **기존 Agents.jsx**: **InstancedMesh** 사용으로 매우 효율적이고 부드러운 렌더링
- **새로운 UnifiedCitizenRenderer**: **개별 Mesh** 생성으로 성능 저하 및 이동 끊김
- **결론**: 개별 메쉬 방식이 InstancedMesh의 최적화를 잃어버림

#### 🔄 **해결 방법**
- **완전 롤백**: 기존 Agents.jsx의 **InstancedMesh 방식 복원**
- **성능 유지**: 시민별 개별 메쉬 대신 인스턴스 메쉬 사용
- **부드러운 움직임**: 기존의 예측 이동 및 스무딩 로직 그대로 유지

### 📊 **InstancedMesh vs 개별 Mesh 비교**

#### ✅ **InstancedMesh 방식 (복원됨)**
- **성능**: 하나의 draw call로 수백 개 시민 렌더링
- **메모리**: 최소한의 GPU 메모리 사용
- **애니메이션**: `setMatrixAt()`으로 매끄러운 위치 업데이트
- **최적화**: Three.js 내장 인스턴싱 최적화 활용

#### ❌ **개별 Mesh 방식 (문제였음)**
- **성능**: 시민마다 별도 draw call 필요
- **메모리**: 시민당 개별 메쉬 오브젝트 생성
- **애니메이션**: 개별 메쉬 위치 업데이트로 오버헤드 발생
- **최적화**: GPU 인스턴싱 활용 불가

### 🎯 **복원된 기능들**

#### 1. **부드러운 예측 이동**
- 렌더 프레임마다 목표 지점으로 부드럽게 전진
- `spd = 2.2 * (0.9 + AGI*0.02)` 민첩성 기반 속도
- `dtRender` 기반 프레임 독립적 이동

#### 2. **고급 스무딩 시스템**
- **위치 스무딩**: 0.28 (정지), 0.2 (이동 중 높이)
- **방향 스무딩**: 0.15 계수로 자연스러운 회전
- **시각적 위치 캐시**: `visById`, `prevById`로 부드러운 보간

#### 3. **완전한 애니메이션**
- **몸체 바운스**: `computeBodyBounce()` 자연스러운 상하 움직임
- **걷기 애니메이션**: `computeWalkSwing()` 팔 흔들기 및 발걸음
- **기울임 효과**: 걸을 때 미세한 몸체 기울임
- **팔 관절**: 동적 팔 길이 계산 및 자연스러운 움직임

#### 4. **시각적 효과**
- **시민별 색상**: `appearance` 기반 개별 외형
- **라벨 시스템**: 이름 + 작업 이모지 표시
- **선택 할로**: 선택된 시민 강조 표시
- **색상 캐싱**: 프레임당 컬러 버퍼 갱신 최소화

### 🚀 **성능 향상**

#### **렌더링 효율성**
- **Draw Calls**: 수백 개 → 6개 (몸체, 머리, 팔×2, 손×2)
- **GPU 메모리**: 대폭 절약 (공유 geometry 및 material)
- **CPU 오버헤드**: InstancedMesh 최적화로 최소화

#### **애니메이션 품질**
- **60fps**: 높은 프레임레이트에서도 부드러운 움직임
- **대규모**: 수백 명의 시민이 동시에 부드럽게 이동
- **반응성**: 즉각적인 방향 전환 및 상태 변화

### 🎯 **결과**
- ✅ **완벽한 이동 복원**: 기존과 동일한 부드러운 시민 이동
- ✅ **최고 성능**: InstancedMesh의 GPU 최적화 활용
- ✅ **메모리 효율**: 최소한의 리소스로 최대 품질
- ✅ **확장성**: 수백 명의 시민도 부드럽게 처리

---

## 2025-01-27 - 🐛 군락지 렌더링 및 모바일 화면 문제 수정

### 🔧 수정 내용
**군락지 무한 반복 문제 및 모바일 흰색 화면 문제 해결**

### 📋 주요 수정사항

#### 1. **군락지 데이터 처리 방식 수정**
- **문제**: 배열로 전달되는 군락지 데이터를 객체로 처리하려고 시도
- **해결**: `Array.isArray()` 체크를 통해 배열/객체 모두 처리 가능하도록 수정
- **결과**: 군락지 무한 반복 생성/삭제 문제 해결

#### 2. **디버그 로그 정리**
- **문제**: 과도한 콘솔 로그로 인한 성능 저하
- **해결**: 불필요한 디버그 로그 제거
- **결과**: 콘솔 스팸 방지 및 성능 향상

#### 3. **모바일/작은 화면 흰색 화면 문제 해결**
- **문제**: 모바일 세로 화면이나 작은 화면에서 흰색으로 표시
- **해결**: 
  - Canvas에 명시적 배경색 설정 (`background: '#eaf7ff'`)
  - CSS 스타일 개선 (`width: '100%', height: '100%'`)
  - 최소 높이 인라인 스타일 추가 (`minHeight: '480px'`)
- **결과**: 모든 화면 크기에서 일관된 배경색 표시

### 🎯 결과
- ✅ **군락지 안정화**: 무한 반복 문제 완전 해결
- ✅ **모바일 호환성**: 세로 화면에서도 정상 렌더링
- ✅ **성능 향상**: 불필요한 로그 제거로 콘솔 성능 개선
- ✅ **일관된 UI**: 모든 디바이스에서 동일한 시각적 경험

---

## 2025-01-27 - 🐛 통합 렌더러 오류 수정

### 🔧 수정 내용
**UnifiedMonsterRenderer 관련 오류들 수정**

### 📋 주요 수정사항

#### 1. **Scene3D.jsx - updateAnimations 메서드 호출 제거**
- ❌ **기존**: `threeRef.current.monsterManager.updateAnimations(dt * 1000)`
- ✅ **수정**: 애니메이션이 `updateMonsters`에서 자동으로 처리되도록 변경
- 🎯 **결과**: `updateAnimations is not a function` 오류 해결

#### 2. **UnifiedMonsterRenderer.js - 군락지 속성명 수정**
- ❌ **기존**: `nest.biome` 속성 사용
- ✅ **수정**: `nest.biomeType` 속성 사용 (실제 데이터 구조에 맞춤)
- 🎯 **결과**: 군락지 타입이 제대로 인식되어 올바른 메쉬 생성

#### 3. **군락지 무한 반복 문제 해결**
- ❌ **기존**: 군락지가 계속 생성/삭제되는 무한 루프
- ✅ **수정**: `addNest()`에서 이미 존재하는 군락지 중복 추가 방지
- 🎯 **결과**: 군락지가 안정적으로 한 번만 생성됨

#### 4. **불필요한 로그 제거**
- 디버그 로그 대폭 감소로 콘솔 스팸 방지
- 성능 개선 및 개발 경험 향상

### 🎯 결과
- ✅ **오류 해결**: `updateAnimations is not a function` TypeError 완전 제거
- ✅ **군락지 안정화**: 무한 반복 생성/삭제 문제 해결
- ✅ **올바른 렌더링**: 숲/사막 군락지가 제대로 구분되어 렌더링
- ✅ **성능 향상**: 불필요한 로그 및 중복 처리 제거

---

## 2025-01-27 - 🐛 물리 시스템 export 오류 수정

### 🔧 수정 내용
**`physics.js`에서 누락된 `getGroundHeight` 함수 추가 및 export**

### 📋 주요 변경사항
- **`src/world/physics.js` 확장**
  - `getGroundHeight(x, z)`: 노이즈 기반 지형 높이 계산
  - `placeOnGround(object, offset)`: 객체를 땅 위에 배치
  - `isOnGround(object, tolerance)`: 객체가 땅 위에 있는지 확인

### 🎯 결과
- ✅ `EntityRenderManager.js`에서 `getGroundHeight` import 오류 해결
- ✅ 통합 엔티티 렌더링 시스템 정상 작동
- ✅ 모든 엔티티가 올바른 땅 높이에 배치됨

---

## 2025-01-27 - 🎯 통합 엔티티 렌더링 시스템 구축 완료

### 🔧 주요 작업 내용
**시민과 몬스터의 이동/렌더링을 통합하고 애니메이션을 분리하여 동일한 품질의 움직임 구현**

### 📋 새로 생성된 파일들

#### 1. **중앙 렌더링 시스템**
- **`src/components/managers/EntityRenderManager.js`**
  - 시민과 몬스터에 동일한 렌더링 로직 제공
  - 위치 스무딩, 방향 스무딩, 라벨 관리, 선택 할로
  - 메모리 효율적인 엔티티 인스턴스 관리

#### 2. **애니메이션 시스템 분리**
- **`src/components/animations/CitizenAnimations.js`**
  - 시민 전용 메쉬 생성 및 애니메이션
  - 걷기 애니메이션, 팔 흔들기, 몸체 기울임
  - 외형 정보 기반 색상 시스템
  
- **`src/components/animations/MonsterAnimations.js`**
  - 몬스터 타입별 고유 메쉬 생성 (고블린, 오크, 트롤, 스켈레톤, 늑대, 슬라임)
  - 각 몬스터별 특색 있는 애니메이션 (둥실둥실, 꾸물꾸물, 무거운 걸음 등)
  - 통합 애니메이션 업데이트 시스템

#### 3. **통합 렌더러들**
- **`src/components/agents/UnifiedCitizenRenderer.jsx`**
  - 기존 Agents.jsx를 대체
  - EntityRenderManager + CitizenAnimations 사용
  - 동일한 UI/UX 제공하면서 내부 구조 개선
  
- **`src/components/managers/UnifiedMonsterRenderer.js`**
  - 기존 MonsterManager.js를 대체
  - EntityRenderManager + MonsterAnimations 사용
  - 군락지 렌더링도 포함

### 🔄 확장된 이동 시스템

#### **`src/game/systems/movement.js` 확장**
1. **통합 이동 함수**
   - `moveEntity(entity, targetPosition, deltaTime, entityType)`
   - 시민('citizen')과 몬스터('monster') 모두 지원
   - 동일한 속도 계산, 물리법칙, 도달 판정

2. **시각적 스무딩 함수들**
   - `getSmoothedPosition()`: 위치 보간 (0.28/0.2 계수)
   - `getSmoothedDirection()`: 방향 스무딩 (0.15 계수)
   - `clearMovementCache()`: 캐시 정리

3. **하위 호환성**
   - 기존 `runMovement()` 함수 유지
   - 내부적으로 새로운 `moveEntity()` 사용

### 🔧 AI 시스템 업데이트

#### **몬스터 AI (`src/game/systems/monsterAI.js`)**
- `moveTowardsTarget()` 함수를 통합 이동 시스템 사용하도록 수정
- 기존 개별 이동 로직 제거, 시민과 동일한 이동 품질 확보

#### **부대 AI (`src/game/systems/squadAI.js`)**
- `moveTowardsTarget()` 함수를 통합 이동 시스템 사용하도록 수정
- 부대 명령 실행 시에도 시민과 동일한 이동 품질 보장

### 🎨 Scene3D 통합

#### **`src/components/Scene3D.jsx` 수정**
- `Agents` → `UnifiedCitizenRenderer` 교체
- `MonsterManager` → `UnifiedMonsterRenderer` 교체
- 기존 기능은 모두 유지하면서 내부 구조만 개선

### 🎯 달성된 목표

#### ✅ **동일한 이동 품질**
- 시민과 몬스터가 완전히 동일한 이동 알고리즘 사용
- 동일한 속도 계산: `speedBase * (0.8 + AGI * 0.04)`
- 동일한 스무딩: 위치/방향 보간으로 부드러운 움직임
- 동일한 물리법칙: 땅 높이 적용, 도달 판정

#### ✅ **분리된 애니메이션**
- 시민: 현실적인 걷기 애니메이션, 팔 흔들기, 몸체 기울임
- 몬스터: 타입별 고유 애니메이션 (고블린 둥실둥실, 슬라임 꾸물꾸물 등)
- 각각 독립적으로 발전 가능한 구조

#### ✅ **코드 품질 향상**
- 중복 코드 대폭 제거 (이동 로직 통합)
- 단일 책임 원칙 적용 (렌더링, 애니메이션, 이동 분리)
- 확장성 있는 아키텍처 (새로운 엔티티 타입 추가 용이)

#### ✅ **성능 최적화**
- 메모리 효율적인 엔티티 관리
- 캐시 기반 스무딩으로 CPU 사용량 감소
- 불필요한 메쉬 생성/삭제 제거

#### ✅ **유지보수성**
- 중앙집중화된 렌더링 시스템
- 모듈화된 애니메이션 시스템
- 일관된 이동 시스템

### 🔮 향후 확장성
- 새로운 엔티티 타입 추가 시 `EntityRenderManager` 재사용 가능
- 애니메이션 시스템 독립적 발전 가능
- 이동 시스템에 새로운 기능 추가 시 모든 엔티티에 자동 적용

---

## 2025-01-27 - 건물 배치 시 클릭 이벤트 무시 수정

### 🔧 수정 내용
**건물 배치 모드에서 마우스 클릭이 청사진에 영향을 주지 않도록 수정**

### 📋 주요 변경사항
1. **InteractionHandler.js - onClick 함수 수정**
   - 배치 모드(`state.ui.placing`)일 때 모든 클릭 이벤트 무시
   - 기존: 터치 이벤트만 무시하고 마우스 클릭은 청사진에 영향
   - 수정: 배치 모드에서는 마우스 클릭도 완전히 무시
   - `handleBlueprintDrag` 호출 제거

2. **더블클릭 이벤트**
   - 이미 배치 모드일 때 무시하도록 구현되어 있음
   - 추가 수정 불필요

### 🎯 결과
- ✅ 건물 배치 모드에서 마우스 클릭이 청사진에 영향 없음
- ✅ 배치 중 의도치 않은 청사진 이동 방지
- ✅ 더 안정적인 건물 배치 경험
- ✅ 터치와 마우스 모두 일관된 동작

---

## 2025-01-27 - 몬스터 군락지 렌더링 시스템 구현

### 🐛 해결된 문제
**몬스터 군락지와 몬스터가 3D 씬에서 보이지 않는 문제**

### 🔧 주요 수정 내용
1. **MonsterManager.js - 군락지 렌더링 시스템 추가**
   - 군락지 메쉬 그룹 (`nestGroup`) 추가
   - 숲 군락지 메쉬: 나무와 나뭇잎으로 구성
   - 사막 군락지 메쉬: 바위와 작은 바위들로 구성
   - `updateNests()`, `addNest()`, `removeNest()` 함수 구현

2. **Scene3D.jsx - 군락지 업데이트 통합**
   - 몬스터 업데이트와 함께 군락지도 업데이트
   - `state.monsterNests`에서 군락지 데이터 가져와서 렌더링

3. **monsterSystem.js - 몬스터 스폰 로직 수정**
   - `updateMonsterNest()` 함수 추가
   - 군락지에서 몬스터 스폰 타이머 관리
   - 스폰된 몬스터를 게임 상태에 자동 추가

### 📋 군락지 시각적 특징
- **숲 군락지**: 
  - 기반: 어두운 녹색 원형 (반경 3)
  - 중앙: 나무 (갈색 원기둥)
  - 상단: 나뭇잎 (녹색 구체)
  
- **사막 군락지**:
  - 기반: 갈색 원형 (반경 3)
  - 중앙: 큰 바위 (회색 구체)
  - 주변: 4개의 작은 바위들

### 🎯 결과
- ✅ 군락지가 3D 씬에서 명확하게 표시됨
- ✅ 몬스터 스폰 시스템 정상 작동
- ✅ 군락지별 고유한 시각적 특징
- ✅ 부대 공격 명령으로 군락지 공략 가능
- ✅ 실시간 몬스터 스폰 및 렌더링

---

## 2025-01-27 - 부대 공격 명령 개선

### 🔧 개선 내용
**부대 공격 명령이 이동 경로상의 적을 공격하도록 수정**

### 📋 주요 변경사항
1. **handleAttackCommand 함수 개선**
   - ❌ 기존: 목표 지점 도달 후에만 적 공격
   - ✅ 수정: 이동 중에도 주변 적 탐지 및 공격
   - 공격 범위를 5.0에서 8.0으로 확대
   - 공격 가능 거리: 3.0 이내

2. **공격 우선순위 시스템**
   - 이동 중 주변 적 탐지 (8.0 범위)
   - 적 발견 시 적에게 우선 접근/공격
   - 적이 없으면 목표 지점으로 이동 계속

3. **attackEnemy 함수 개선**
   - 공격 쿨다운 시스템 추가 (1초마다 공격 가능)
   - `unit.lastAttackTime`으로 공격 시간 추적
   - 연속 공격 방지로 현실적인 전투 구현

### 🎯 공격 명령 동작 방식
1. **이동 중 적 탐지**: 목표 지점으로 이동하면서 주변 8.0 범위 내 적 탐지
2. **적 발견 시**: 가장 가까운 적에게 접근하여 공격
3. **공격 후**: 적이 죽거나 범위를 벗어나면 다시 목표 지점으로 이동
4. **목표 도달**: 목표 지점에 도달하고 적이 없으면 대기

### 🎮 결과
- ✅ 이동 경로상의 모든 적을 자동으로 공격
- ✅ 현실적인 공격 쿨다운 시스템
- ✅ 더 전략적이고 효율적인 부대 운영
- ✅ 몬스터 군락지 공략 시 자동 전투

---

## 2025-01-27 - 몬스터 군락지 초기 생성 수정

### 🐛 해결된 문제
**몬스터 군락지가 게임 시작 시 보이지 않는 문제**

### 🔧 수정 내용
1. **state.js - initializeMonsterSystem 함수 개선**
   - `generateRandomNest` 대신 `createMonsterNest` 직접 사용
   - 고정 위치로 초기 군락지 생성
   - 첫 번째 군락지: 북동쪽 (50, 0, 50) - 숲 타입
   - 두 번째 군락지: 남서쪽 (-60, 0, -60) - 사막 타입
   - 상세한 로그 출력으로 생성 과정 확인 가능

2. **Import 추가**
   - `createMonsterNest` 함수 import 추가

### 📋 생성되는 초기 군락지
- **숲 군락지**: 마을 중심에서 북동쪽으로 50만큼 떨어진 위치
- **사막 군락지**: 마을 중심에서 남서쪽으로 60만큼 떨어진 위치
- 각 군락지는 레벨 1로 시작하여 몬스터를 스폰

### 🎯 결과
- ✅ 게임 시작 시 즉시 몬스터 군락지 2개 생성
- ✅ 군락지 위치가 명확하게 표시됨
- ✅ 몬스터 스폰 시스템 정상 작동
- ✅ 부대 공격 명령으로 군락지 공략 가능

---

## 2025-01-27 - 부대 시스템 오류 수정

### 🐛 해결된 문제
1. **React Hooks 오류**: SquadInspector에서 조건부 return이 hooks보다 먼저 실행되어 발생한 오류
2. **TypeError**: squadAI.js에서 undefined 객체의 속성 접근으로 인한 오류

### 🔧 수정 내용
1. **SquadInspector.jsx**
   - 모든 hooks를 컴포넌트 최상단으로 이동
   - 조건부 return을 hooks 실행 후로 이동
   - useEffect 의존성을 `state.ui.selectedSquadId`로 변경

2. **squadAI.js**
   - 모든 명령 함수에 유효성 검사 추가
   - `unit.position`, `targetPosition` 등 null/undefined 체크
   - `calculateDistance` 호출 전 매개변수 검증

3. **InteractionHandler.js**
   - `executeSquadCommand` 호출 전 `hit` 객체 유효성 검사 추가
   - `hit.x`, `hit.z` 속성 존재 확인

### 📋 수정된 함수들
- `handleAttackCommand`: targetPosition, unit.position 검증
- `handleRetreatCommand`: unit.position 검증
- `handlePatrolCommand`: targetPosition, unit.position 검증
- `findNearbyEnemies`: unit.position 검증
- `findNearestTownHall`: unit.position 검증
- `moveTowardsTarget`: unit.position, targetPosition 검증

### 🎯 결과
- ✅ React Hooks 규칙 준수
- ✅ TypeError 완전 해결
- ✅ 부대 시스템 안정성 향상
- ✅ 오류 없이 게임 실행 가능

---

## 2025-01-27 - 부대 시스템 구현

### 🔧 변경 파일
1. `src/components/MainMenu.jsx`
   - 부대⚔️ 탭 추가
   - 부대 목록 표시 및 명령/배치 버튼 구현
   - 부대 배치 시 SquadInspector 표시

2. `src/components/SquadInspector.jsx` (신규)
   - 부대 인스펙터 컴포넌트 구현
   - 부대 이름 변경 기능
   - 시민 소속 관리 (배치/해제)
   - 부대 이동 모드 활성화/비활성화

3. `src/components/SquadMoveDisplay.jsx` (신규)
   - 부대 이동 모드 시 HP/MP 표시 컴포넌트
   - 각 시민별 상태 정보 표시
   - 이동 안내 메시지

4. `src/components/Inspector.jsx`
   - 부대 인스펙터 통합
   - 부대 선택 상태 관리
   - 외부 클릭 감지에 부대 선택 포함

5. `src/components/managers/InteractionHandler.js`
   - 부대 이동 모드 클릭 처리 로직 추가
   - 지도 클릭 시 부대 전체 이동 기능

6. `src/game/state.js`
   - 부대 상태 관리 (squads 객체)
   - 부대 관련 액션 함수들 추가
   - 초기 부대 생성 함수 추가

7. `src/App.jsx`
   - SquadMoveDisplay 컴포넌트 통합
   - 초기 부대 생성 로직 추가

8. `README.md`
   - 부대 시스템 기능 설명 추가
   - 프로젝트 구조에 부대 관련 파일들 추가

### 🎮 새로운 기능
- **부대 생성 및 관리**: 메인 메뉴의 부대 탭에서 부대 목록 확인
- **시민 소속 관리**: 부대 배치 버튼으로 시민을 부대에 소속시키거나 해제
- **부대 이동**: 부대 이동 모드 활성화 시 지도 클릭으로 부대 전체 이동
- **이동 모드 표시**: 부대 이동 시 각 시민의 HP/MP 상태를 하단에 표시
- **부대 인스펙터**: 부대 이름 변경, 시민 관리, 이동 모드 제어

### 📈 효과
- 시민들을 부대로 편성하여 집단 이동 및 관리 가능
- 건물 소속과 별개로 부대 소속 관리로 전략적 깊이 증가
- 부대 이동 시 시각적 피드백으로 게임 몰입감 향상
- 향후 전투 시스템 확장을 위한 기반 마련

---

## 2025-09-22 - 모바일 세로 화면 시 가로 강제 로직 단순화

### 🔧 변경 파일
1. `src/App.jsx`
   - 런타임에서 `window.innerWidth < window.innerHeight` 체크로 `.force-landscape` 클래스 토글 추가
   - 리스너: `resize`, `orientationchange`
2. `src/index.css`
   - 복잡한 오리엔테이션 미디어쿼리/문서 회전 제거
   - `.force-landscape` 클래스 추가: 컨테이너만 90도 회전(고정 위치, overflow hidden)
3. `README.md`
   - 모바일 비율 처리 섹션 추가(동작 방식/장점)

### 🐛 해결된 문제
- 세로 화면 또는 가로 짧은 디바이스에서 흰 화면만 보이던 문제
- 문서 전체 회전으로 인한 레이아웃/좌표계 혼란

### 🎯 결과
- 단순한 비율 기반 가로 강제 처리로 안정적인 표시
- 캔버스와 UI가 항상 화면을 꽉 채우며 정상 동작

## 2025-01-27 - 몬스터 시스템 완전 구현

### 🔧 변경 파일
1. `src/game/content/monsters.js` (신규)
   - 몬스터 정의 시스템 구현
   - 몬스터 타입별 스탯 범위 정의 (고블린, 오크, 트롤, 스켈레톤, 늑대, 슬라임)
   - 지형별 몬스터 군락지 정의 (숲, 평원, 사막, 툰드라)
   - 몬스터 스탯 랜덤 생성 및 레벨 보정 함수

2. `src/game/systems/monsterNests.js` (신규)
   - 몬스터 군락지 시스템 구현
   - 군락지 생성, 레벨링, 스폰 관리
   - 시간 기반 경험치 증가 및 자동 레벨업
   - 군락지 방어 모드 및 집결 시스템

3. `src/utils/combatUtils.js` (신규)
   - 전투 유틸리티 함수들 구현
   - 공격 타입별 대미지 계산 (근접, 원거리, 마법, 특수)
   - 무기 정의 및 공격 모션 시스템
   - 원거리 무기 및 투사체 시스템

4. `src/game/systems/monsterAI.js` (신규)
   - 몬스터 AI 및 전투 시스템 구현
   - AI 상태 관리 (대기, 순찰, 추적, 공격, 복귀, 도주, 방어)
   - 집단 행동 및 포위 전술 시스템
   - 몬스터별 행동 패턴 정의

5. `src/game/systems/monsterSystem.js` (신규)
   - 몬스터 시스템 통합 관리
   - 게임 루프에서 호출되는 메인 실행 함수
   - 군락지 및 몬스터 업데이트 통합
   - 시스템 통계 및 디버그 정보 제공

6. `src/components/managers/MonsterManager.js` (신규)
   - 몬스터 3D 렌더링 및 애니메이션 관리
   - 몬스터 타입별 메쉬 생성 (고블린, 오크, 트롤, 스켈레톤, 늑대, 슬라임)
   - 몬스터 애니메이션 시스템 (호흡, 보행, 공격)
   - HP에 따른 색상 변화 효과

7. `src/game/state.js`
   - 몬스터 시스템 상태 추가 (monsters, monsterNests)
   - 몬스터 관련 액션 함수들 추가
   - 몬스터 시스템 초기화 함수 추가

8. `src/game/gameLoop.js`
   - 몬스터 시스템 실행 함수 통합
   - 게임 루프에 몬스터 업데이트 추가

9. `src/App.jsx`
   - 몬스터 시스템 초기화 추가
   - 게임 시작 시 몬스터 시스템 활성화

10. `src/components/Scene3D.jsx`
    - MonsterManager 통합 및 초기화
    - 몬스터 렌더링 및 애니메이션 업데이트
    - 렌더링 루프에 몬스터 애니메이션 추가

11. `README.md`
    - 몬스터 시스템 기능 설명 추가
    - 프로젝트 구조에 몬스터 관련 파일들 추가

### 🎮 새로운 기능
- **몬스터 정의 시스템**: 6가지 몬스터 타입 (고블린, 오크, 트롤, 스켈레톤, 늑대, 슬라임)
- **지형별 군락지**: 각 지형마다 다른 몬스터가 등장하는 군락지 시스템 (숲, 평원, 사막, 툰드라)
- **랜덤 스폰**: 마을 범위 제외 지역에 랜덤한 타이밍과 위치에 군락지 생성
- **군락지 레벨링**: 시간 경과에 따른 경험치 증가 및 자동 레벨업
- **몬스터 AI**: 순찰, 추적, 공격, 방어 등 다양한 AI 행동 패턴
- **전투 시스템**: 공격 모션, 대미지 계산, 원거리 무기 시스템
- **집단 행동**: 몬스터들이 집단으로 행동하는 포위 전술
- **3D 렌더링**: 몬스터별 고유한 3D 모델 및 애니메이션

### 📈 효과
- 게임의 전략적 깊이와 도전 요소 대폭 증가
- 지형별 몬스터 분포로 탐험의 재미 증대
- 군락지 시스템으로 장기적인 위협 요소 제공
- 몬스터 AI로 생동감 있는 게임 세계 구현
- 전투 시스템 기반 마련으로 향후 확장 가능

---

### 🔧 변경 파일
1. `src/index.css`
   - 모바일 환경에서 가로 모드 강제 CSS 추가
   - 세로 모드일 때 화면을 90도 회전하여 가로 모드로 강제 전환
   - 동적 뷰포트 높이(dvh) 지원으로 모바일 브라우저 UI 고려
   - 스크롤 방지를 위한 overflow: hidden 설정

2. `src/components/Scene3D.jsx`
   - 모바일 환경에서 화면 높이를 100vh로 설정하여 화면을 꽉 채움
   - 데스크톱에서는 기존 rounded-2xl 유지, 모바일에서는 제거

3. `src/components/Inspector.jsx`
   - 모든 인스펙터 컴포넌트의 너비를 모바일에서 95vw로 조정
   - 데스크톱에서는 기존 고정 너비 유지

4. `src/components/ItemInspector.jsx`
   - 아이템 인스펙터 너비를 모바일에서 95vw로 조정

5. `src/components/CraftingInspector.jsx`
   - 제작 인스펙터 너비를 모바일에서 95vw로 조정

6. `src/components/MainMenu.jsx`
   - 메인 메뉴 위치를 모바일에서 right-1로 조정하여 여백 최소화

7. `src/components/HUD.jsx`
   - HUD 위치를 모바일에서 left-1로 조정하여 여백 최소화

8. `src/components/BuildCancelButton.jsx`
   - 버튼 간격을 모바일에서 gap-1로 조정하여 공간 효율성 향상

### 🎯 변경 내용
- **모바일 세로 모드**: 화면을 90도 회전하여 가로 모드로 강제 전환
- **화면 꽉 채우기**: 맵이 화면 전체를 차지하도록 설정
- **스크롤 방지**: 불필요한 스크롤 제거
- **UI 요소 조정**: 모든 UI 요소의 크기와 위치를 모바일에 최적화

### 📈 효과
- 모바일에서 맵이 화면을 꽉 채워 더 넓은 시야 확보
- 세로 모드에서도 가로 모드로 강제 전환되어 게임 플레이 최적화
- 인스펙터와 메뉴가 모바일 화면에 맞게 조정되어 사용성 향상
- 불필요한 여백과 스크롤 제거로 몰입감 증대

---

## 2025-01-27 - 창고 장비 장착 시민 선택 목록 컴팩트 UI 개선

### 🔧 변경 파일
1. `src/components/CitizenSelectionModal.jsx`
   - 시민 선택 목록을 컴팩트하게 개선
   - 왼쪽: 시민 이름 + 소속 배지 (건물 이름)
   - 오른쪽: 장착 중인 같은 부위의 장비 정보 (있으면 장비명, 없으면 "장비종류 없음")
   - 기존 세로 레이아웃에서 가로 레이아웃으로 변경하여 공간 효율성 향상
   - 패딩과 간격을 줄여서 더 많은 시민을 한 화면에 표시

### 🎯 변경 내용
- **기존**: 세로 레이아웃으로 시민 이름, HP, 모든 장착 장비 정보를 표시
- **변경**: 가로 레이아웃으로 시민 이름 + 소속 배지, 현재 장착할 장비와 같은 부위의 장비 정보만 표시
- 더 간결하고 직관적인 정보 표시
- 장비 장착 시 해당 부위의 기존 장비 상태를 한눈에 파악 가능

### 📈 효과
- 시민 선택 목록이 더 컴팩트하고 읽기 쉬워짐
- 장비 부위별 충돌 상황을 즉시 확인 가능
- 소속 건물 정보가 배지로 명확하게 표시
- UI 공간 효율성 향상으로 더 많은 시민을 한 번에 볼 수 있음

---

## 2025-01-27 - 카메라 초기 각도 조정

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - 카메라 초기 위치를 더 수직으로 바라보게 조정
   - 기존: `camera.position.set(25, 20, 25)` (수평에 가까운 각도)
   - 변경: `camera.position.set(15, 35, 15)` (더 수직적인 각도)
   - Y축 높이 증가(20 → 35)로 위에서 내려다보는 시점 강화
   - X, Z축 거리 감소(25 → 15)로 더 가까운 시점 제공

### 🎯 변경 내용
- 게임 시작 시 카메라가 더 위에서 내려다보는 각도로 설정
- 지형과 건물들을 더 잘 볼 수 있는 시점 제공
- 사용자 경험 향상을 위한 초기 카메라 각도 최적화

### 📈 효과
- 게임 시작 시 더 나은 시야각으로 지형 파악 용이
- 건물 배치 및 게임 플레이에 더 적합한 카메라 위치
- 초기 사용자 경험 개선

---

## 2025-01-27 - 청사진 기반 건물 배치 시스템 구현

### 🔧 변경 파일
1. `src/components/managers/BlueprintManager.js` (신규)
   - 청사진 시스템 관리 클래스 구현
   - 맵 중앙에 청사진 생성, 마우스 드래그로 위치 조정
   - 배치 유효성 실시간 체크 및 색상 변경
   - 건물 타입별 지오메트리 생성 및 와이어프레임 렌더링

2. `src/components/BuildCancelButton.jsx`
   - 하단 UI에 건물 배치 버튼 추가 (건축 취소 버튼과 나란히)
   - 청사진 위치에서 건물 배치 확정 로직 구현
   - 배치 유효성 검사 및 오류 메시지 표시

3. `src/components/managers/InteractionHandler.js`
   - 청사진 드래그 로직 구현 (마우스 클릭/이동/업 이벤트 처리)
   - 기존 고스트 메쉬 시스템을 청사진 시스템으로 교체
   - 드래그 시작/업데이트/종료 처리

4. `src/components/Scene3D.jsx`
   - BlueprintManager 통합 및 초기화
   - 기존 고스트 메쉬 시스템 제거
   - 청사진 생성/제거 로직 구현

5. `README.md`
   - 청사진 기반 건물 배치 시스템 설명 추가
   - 프로젝트 구조에 BlueprintManager 추가
   - Build/배치 루프 설명 업데이트

### 🎯 새로운 기능
- **청사진 시스템**: 건물 선택 시 맵 중앙에 청사진 생성
- **드래그 앤 드롭**: 마우스/터치로 청사진을 드래그하여 위치 조정
- **실시간 유효성 검사**: 배치 가능 여부에 따른 청사진 색상 변경 (초록/빨강)
- **하단 UI 통합**: 건물 배치 버튼과 건축 취소 버튼을 하단에 나란히 배치
- **배치 확정**: 청사진 위치에서 건물 배치 버튼으로 확정

### 📈 효과
- 더 직관적인 건물 배치 시스템으로 사용자 경험 향상
- 청사진을 통한 시각적 피드백으로 배치 위치 명확화
- 드래그 앤 드롭 방식으로 정확한 위치 조정 가능
- 기존 클릭 기반 시스템 대비 더 나은 사용성 제공

---

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - OrbitControls의 마우스 버튼 설정 변경
   - 왼쪽 버튼: 맵 이동(PAN) 기능으로 변경
   - 오른쪽 버튼: 카메라 회전(ROTATE) 기능으로 변경
   - 가운데 버튼: 줌(DOLLY) 기능 유지
   - 모바일 터치 설정 추가: 한 손가락으로 팬(맵 이동), 두 손가락으로 줌/회전

### 🎮 변경 내용
- 기존: 마우스 오른쪽 드래그로 맵 이동
- 변경: 마우스 왼쪽 드래그로 맵 이동
- 모바일: 한 손가락 터치로 맵 이동, 두 손가락 터치로 줌/회전
- 사용자 편의성 향상을 위한 조작 방식 개선

### 📈 효과
- 더 직관적인 마우스 조작 방식 제공
- 일반적인 3D 애플리케이션과 일관된 조작감
- 모바일과 데스크톱 환경 모두에서 일관된 사용자 경험 제공

## 2025-09-15 - 잔상/깜빡임 개선(렌더러 불투명 전환 + RAF 정리)

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - `WebGLRenderer({ alpha:false, powerPreference:'high-performance', premultipliedAlpha:false, depth:true, stencil:false })`
   - `renderer.autoClear = true; renderer.setClearColor(0xeaf7ff, 1);`
   - 렌더 루프에 `running` 플래그 및 `rafId` 추가, 언마운트 시 `cancelAnimationFrame(rafId)`와 함께 중단

### 🐛 해결된 현상
- 간헐적 잔상/화면 깜빡임(특히 탭 전환/리마운트 후) 현상 완화
- 중복 RAF로 인한 프레임 타이밍 충돌 방지

### 📈 효과
- 프레임 안정성 향상 및 합성 레이어 아티팩트 제거
- 장시간 플레이/탭 전환 시 시각적 일관성 개선

## 2025-01-27 - 창고 및 제작 시스템 구현

### 🔧 변경 파일
1. `src/game/content/items.js` (신규)
   - 아이템 정의 시스템 구현
   - 소비 아이템: 재료 상자, 재능 상승, 스탯 상승 아이템
   - 장비 아이템: 무기(검), 갑옷, 악세사리(반지)
   - 아이템별 제작 비용 및 효과 정의

2. `src/game/systems/warehouse.js` (신규)
   - 창고 시스템 관리
   - 아이템 추가/제거, 사용/장착 기능
   - 아이템 분류별 필터링 함수
   - 장비 착용/해제 관리

3. `src/game/systems/crafting.js` (신규)
   - 제작 시스템 관리
   - 대장간/마탑 시민 숙련도 기반 제작 비용 계산
   - 아이템 제작 가능 여부 확인
   - 제작 가능한 아이템 목록 제공

4. `src/components/WarehouseTab.jsx` (신규)
   - 창고 탭 UI 컴포넌트
   - 아이템 목록 표시 및 분류별 필터링
   - 아이템 클릭 시 인스펙터 표시

5. `src/components/CraftingTab.jsx` (신규)
   - 제작 탭 UI 컴포넌트
   - 제작 가능한 아이템 목록 표시
   - 시민 숙련도 기반 제작 비용 표시
   - 아이템 제작 실행

6. `src/components/ItemInspector.jsx` (신규)
   - 아이템 인스펙터 컴포넌트
   - 아이템 정보 표시 및 이름 변경
   - 사용/장착 버튼 제공

7. `src/components/MainMenu.jsx`
   - 창고📦, 제작🔨 탭 추가
   - 새로운 탭 컴포넌트 통합

8. `src/components/Inspector.jsx`
   - 아이템 인스펙터 통합
   - 아이템 선택 시 하단 인스펙터 표시

9. `src/game/state.js`
   - 창고 시스템 상태 추가
   - 아이템 선택 상태 관리
   - 초기 아이템 추가

### 🎮 새로운 기능
- **창고 시스템**: 아이템 저장 및 관리, 종류별 필터링
- **제작 시스템**: 시민 숙련도 기반 아이템 제작
- **아이템 시스템**: 소비/장비 아이템 분류 및 효과
- **아이템 인스펙터**: 아이템 정보 확인 및 사용/장착

### 📈 효과
- 게임의 깊이와 전략성 향상
- 시민 숙련도 활용도 증가
- 자원 관리의 다양성 증대

## 2025-01-27 - 건물 생산 완료 시 자원 이모지 표시 시스템 구현

### 🔧 변경 파일
1. `src/components/managers/ResourceDisplayManager.js` (신규)
   - 건물 생산 완료 시 자원 이모지와 생산량을 표시하는 매니저 클래스
   - 건물 위에 올라가면서 사라지는 애니메이션 효과 구현
   - 자원별 이모지 매핑 (wood: 🪵, stone: 🪨, food: 🍎, gold: 🪙 등)
   - 2초간 표시되며 1.5초 후부터 페이드 아웃 효과

2. `src/components/Scene3D.jsx`
   - ResourceDisplayManager 통합 및 초기화
   - 렌더 루프에 자원 표시 애니메이션 업데이트 추가
   - 전역 접근을 위한 window.__INSU_THREE_REF__ 설정
   - 정리 함수에서 리소스 해제 처리

3. `src/game/systems/production.js`
   - 생산 완료 시 자원 표시 생성 로직 추가
   - 건물 위치 정보를 기반으로 자원 표시 생성
   - 전역 threeRef를 통한 ResourceDisplayManager 접근

### 🎯 기능
- 건물에서 생산이 완료될 때마다 건물 위에 자원 이모지와 생산량이 표시됨
- 자원 표시는 건물 위로 올라가면서 자연스럽게 사라지는 애니메이션
- 각 자원별로 고유한 이모지 사용 (나무🪵, 금🪙, 음식🍎 등)
- 생산량이 숫자로 함께 표시되어 시각적 피드백 제공

### 📈 효과
- 생산 활동의 시각적 피드백으로 게임 몰입감 향상
- 건물별 생산 상태를 직관적으로 파악 가능
- 자원 획득의 즉각적인 시각적 확인으로 만족감 증대

---

## 2025-01-27 - 건물 철거 후 라벨 정리 문제 수정

### 🔧 변경 파일
1. `src/components/managers/LabelManager.js`
   - 건물 삭제 시 해당 건물의 worker 라벨들이 제대로 정리되지 않는 문제 수정
   - `updateConstructionLabels` 메서드에 삭제된 건물의 worker 라벨 정리 로직 추가
   - 건물이 삭제된 경우 해당 건물의 모든 worker 라벨을 자동으로 제거하도록 개선

### 🐛 수정된 문제
- 건물 철거 후 건물 상단에 있던 이름 박스(라벨)들이 사라지지 않던 문제 해결
- 메모리 누수 방지: 삭제된 건물의 라벨 리소스가 제대로 해제되도록 개선

---
## 2025-09-16 - 밸런스 조정: 마을 크기/명성/인구 증가 속도 하향

### 🔧 변경 파일
1. `src/components/managers/TownRangeManager.js`
   - 마을 회관 범위 반경 공식을 `30 + 10*(level-1)` → `24 + 8*(level-1)`로 조정
2. `src/components/managers/InteractionHandler.js`
   - 건물 배치 유효성 검사에서 회관 범위 체크 반경 동일하게 조정
3. `src/game/systems/reputation.js`
   - `REP_SOFT_CAP` 200 → 180
   - 틱당 명성 최대 증가 0.1 → 0.05
   - 합성 명성 스케일 0.2 → 0.14, 최종 적용 시 0.7배
4. `src/game/systems/populationGrowth.js`
   - 요소 가중합 전체에 0.8배 스케일 적용, 최종 캡 0.05 → 0.035
   - 기본/명성/건물/수련/자원 기반 확률 전반 하향, 근상한 페널티 0.5 → 0.4
   - 일부 임계값/이상적 비율(idealRatio 4.0 → 4.2) 조정

### 🎯 목적
- 초기 마을 활동 영역 축소로 난이도와 선택 압력 증가
- 명성/인구 성장 템포 완만화로 중장기 progression 개선

### 📈 효과(예상)
- 초반 건물 배치가 더 조밀해지고 확장 결정의 의미 강화
- 명성 누적과 인구 유입이 느려져 자원/배치/수련의 전략 가치 상승

## 2025-09-15 - 시민 재능/레벨/표시 개편 + 생산력 미리보기

### 🔧 변경 파일
1. `src/game/content/units.js`
   - `rollTalent()`을 모든 스킬 최소 1 이상으로 변경(초기 재능 1~10)
2. `src/game/factory/citizen.js`
   - 시민 객체에서 `level`/`exp` 필드 완전 제거
3. `src/components/Inspector.jsx`
   - 시민 인스펙터 기본정보에서 레벨 → 직업(속한 건물)로 표시 변경
   - 건물 인스펙터의 배치/유휴 목록 우측에 해당 건물에서의 예상 생산력 표시 추가
     (생산 공식 단순화 버전 사용, 자원키와 수치 표시)
4. `src/components/MainMenu.jsx`
   - 시민 탭에서 `Lv.` 제거, 우측에 현재 직업(속한 건물) 표기로 교체
5. `README.md`
   - 시민 데이터 구조/인스펙터 설명 최신화(모든 스킬 최소 1, 레벨 → 직업)

### 🐛/🎯 목적
- 시민이 태어날 때 모든 스킬의 재능을 보유하도록 통일(최소 1)
- 시민 레벨 개념 제거로 단순화, UI에서 직업 중심 정보 제공
- 배치/배치 후보 목록에서 생산력 미리보기로 인사 배치 판단 지원

### 📈 효과
- 초반 시민 성장이 막히지 않고 모든 분야에 참여 가능
- UI 가독성 향상: 레벨 대신 실사용 정보(직업/생산력) 중심
- 인력 배치 결정이 직관적으로 개선


## 2025-09-11 - 시작 렉 급증 원인 최적화

### 🔧 변경 파일
1. `src/components/Scene3D.jsx`
   - 프레임 루프에서 `labelManager.updateConstructionLabels` 호출 제거 → 구독 콜백에서만 호출
   - 구독 콜백에 라벨 갱신 추가, 건물/범위/선택 링 업데이트와 동기화

2. `src/components/managers/InteractionHandler.js`
   - 이벤트 리스너 바인딩을 인스턴스 필드로 고정(`this._onMove` 등)하여 dispose 시 정확히 해제되도록 수정

3. `src/components/agents/Agents.jsx`
   - 인스턴스 색상 업데이트 캐싱: 최초 할당 시에만 색상 버퍼 갱신, 매 프레임 갱신 제거

4. `src/components/managers/LabelManager.js`
   - 숨김 시민 스캔 최적화: O(B*U) → O(B+U) (유닛 1회 순회로 빌딩별 그룹화)
   - 불필요한 라벨 정리 로직 개선

5. `src/components/managers/TownRangeManager.js`
   - 반경 변경시에만 지오메트리 재생성(캐시된 `_radius` 비교)

6. `src/game/gameLoop.js`
   - 고정 틱 루프 내 `notify()` 배치: 틱 누적 처리 후 1회만 알림

7. `src/game/state.js`
   - `notify()` coalescing 도입: 같은 프레임 내 다중 호출을 1회로 병합(queueMicrotask)

8. `src/game/systems/production.js`
   - 디버그 로그 가드(`window.__INSU_DEBUG_LOG__`) 추가로 콘솔 스팸 감소

### 🎯 효과
- 시작 시 및 초기 플레이에서의 프레임 드랍 감소
- 상태 변경/구독 기반 렌더 경량화, 라벨/범위/색상 업데이트 비용 감소
- 이벤트 리스너 누수 방지로 장시간 플레이 안정성 향상
# UPDATE.md - 프로젝트 작업 내역

## 2025-01-27 - 시민 인스펙터 크기 압축 및 UI 개선

### 🔧 변경 파일
1. `src/components/Inspector.jsx`
   - 시민 인스펙터의 크기를 대폭 압축하여 간결하게 개선
   - 대제목("기본 정보", "스킬", "인벤토리") 완전 제거
   - 소속을 이름 옆 뱃지로 표시 (기존 텍스트 → 뱃지 형태)
   - "유휴" → "무소속"으로 용어 변경
   - 모든 폰트 크기를 `text-xs`로 통일
   - 기본 정보의 스탯을 세로 한 줄로 압축 (STR AGI, VIT INT)
   - 각 섹션 간 여백을 최대한 줄임 (gap-3 → gap-2, p-2 → p-1.5, h-56 → h-40)
   - 전체 패딩 축소 (p-3 → p-2)

### 🎯 변경 내용
- **기존**: 큰 제목과 넓은 여백으로 인한 공간 낭비
- **변경**: 압축된 레이아웃으로 더 많은 정보를 한 눈에 확인 가능
- **추가 압축**: 각 스탯을 세로로 한 줄씩 나열하여 가독성 향상
- **가로 길이 축소**: 720px → 500px로 인스펙터 폭 축소
- **UI 요소 순서 변경**: 연필 버튼과 소속 뱃지 위치 교체
- **스탯 레이아웃 조정**: STR/AGI, VIT/INT를 각각 두 줄로 그룹화
- **인벤토리 정리**: "아이템 없음" 표시 제거 (시민은 개별 아이템 소지 안함)
- **장비 표시 순서 변경**: 장비 분류(무기, 투구 등)를 위에, 장비 이름을 아래에 표시
- **장비 능력치 레이아웃 개선**: 장비 이름과 능력치를 같은 라인에 나란히 표시
- **전투 스탯 순서 조정**: 방어력과 마법공격 위치 교체 (공격력 → 마법공격 → 방어력)
- **ItemInspector UI 통일**: Inspector.jsx와 동일한 톤앤매너와 레이아웃으로 완전 재구성
  - 400px 폭으로 축소, 압축된 레이아웃 적용
  - 헤더 스타일 통일 (이름 → 연필 → 뱃지 → 닫기)
  - 2열 그리드 레이아웃으로 정보 압축
  - 폰트 크기 및 여백 통일 (text-xs, p-1.5, h-32)
  - 배경 및 스타일 통일 (backdrop-blur, rounded-2xl)
  - 소비 아이템 효과 표시 추가 (식량 +100, 금 +50 등)
  - 소비 아이템 효과 속성명 수정 (effects → effect)
  - 자원 상자, 재능 물약, 스탯 물약 효과 구분하여 표시
- **CraftingInspector UI 통일**: 다른 인스펙터들과 동일한 톤앤매너와 레이아웃으로 완전 재구성
  - 400px 폭으로 통일, 압축된 레이아웃 적용
  - 헤더 스타일 통일 (이름 → 뱃지 → 닫기)
  - 2열 그리드 레이아웃으로 정보 압축
  - 폰트 크기 및 여백 통일 (text-xs, p-1.5, h-32)
  - 배경 및 스타일 통일 (backdrop-blur, rounded-2xl)
  - 자원 이름 한국어 변환 (food → 식량, gold → 금 등)
  - 제작 완료 시 새로 생성된 장비의 인스펙터 자동 표시
- **자원 이모지 통일**: HUD와 생산 표시 이모지를 완전히 통일
  - HUD 광물 이모지: ⛏️ → 🪨 (돌멩이)
  - 생산 표시 이모지: HUD와 동일하게 통일 (🍞 식량, 💰 금, 🪨 광물, 🌿 허브, 🪵 나무)
- **메인 메뉴 UI 개선**: 우측 세로 배치 및 접기/펼치기 기능 추가
  - 위치 변경: absolute → fixed (우측 상단 고정)
  - 레이아웃 변경: 가로 나열 → 세로 나열 (하나의 판 안에 구분)
  - 접기/펼치기 기능: ◀/▶ 이모지로 토글 (방향 수정)
  - 윗부분 꽉 채우기: 토글 버튼이 전체 너비 차지
  - 접힌 상태: 이모지만 표시하되 선택 가능
  - 펼친 상태: 이모지 + 메뉴 이름 표시 (메뉴 글자 제거)
  - 부드러운 애니메이션 효과 적용
  - 탭 콘텐츠 위치 변경: 아래 → 왼쪽 옆에 표시
- **카메라 줌 범위 확장**: 맵 축소 시 더 멀리 볼 수 있도록 개선
  - 최대 줌 거리: 50 → 150 (3배 확장)
  - 마우스 휠 및 터치 핀치 줌으로 더 넓은 시야 확보
- **건축 인스펙터 레이아웃 개선**: UI 요소 재배치로 사용성 향상
  - 닫기 버튼: 하단 → 맨 위로 이동 (✕ 표시)
  - 체력/경험치: 오른쪽 → 철거 버튼 옆으로 이동
  - 레이아웃 최적화: 정보 접근성 및 조작 편의성 개선
- **건물 인스펙터 시민 표시 개선**: 효율 대신 스킬 정보 표시
  - 표시 방식: 효율 → 스킬(재능) 수련치 형식으로 변경
  - 정렬 방식: 재능 높은 순으로 자동 정렬
  - 배치/유휴 인원 모두 동일한 방식으로 표시
- **시민 인스펙터 세션 제목 추가**: 정보 구분을 위한 제목 표시
  - 첫 번째 섹션: "스탯" 제목 추가
  - 두 번째 섹션: "스킬(재능) 수련치" 제목 추가  
  - 세 번째 섹션: "장착된 장비" 제목 추가
- **시민 소속 표시 개선**: 건물 종류 대신 건물 이름으로 표시
  - 표시 우선순위: 건물 이름 → 건물 종류명 → 건물 타입
  - 개인화된 건물명으로 더 명확한 소속 정보 제공
  - 적용 범위: 시민 인스펙터 + 메인 메뉴 시민 목록 모두 적용

### 📈 효과
- 시민 인스펙터가 훨씬 간결하고 컴팩트해짐
- 소속 정보가 뱃지로 표시되어 시각적으로 더 명확함
- 모든 정보가 작은 폰트로 통일되어 일관성 있는 UI
- 공간 효율성 대폭 향상으로 사용자 경험 개선
- 더욱 압축된 레이아웃으로 화면 공간 절약

---

## 2025-01-27 - HUD에서 건설 시간 표시 제거

### 🔧 변경 파일
1. `src/components/HUD.jsx`
   - 건설 중인 건물들의 최소 남은 시간을 표시하는 부분 제거
   - `activeCons` 변수 및 관련 계산 로직 삭제
   - 건설 시간 표시 UI 요소 완전 제거

### 🎯 변경 내용
- 기존: 자원 옆에 "🏗️ 15.2s ×3" 형태로 건설 시간 표시
- 변경: 건설 시간 표시 완전 제거로 HUD 단순화

### 📈 효과
- HUD가 더 깔끔하고 간결해짐
- 자원 정보에 집중할 수 있는 UI 개선
- 건설 진행 상황은 건물 위의 라벨로만 확인 가능

---

## 2025-01-27 - GitHub Pages 자동 배포 설정 완료 및 404 오류 해결

### 🔧 변경 파일
1. `vite.config.js`
   - GitHub Pages 배포를 위한 base path 설정 수정 (`base: '/3D_Poly_Dynasty/'`)
   - 실제 저장소 이름에 맞게 경로 수정하여 404 오류 해결
   - 빌드 설정 최적화 (outDir, assetsDir, sourcemap 설정)

2. `.github/workflows/deploy.yml`
   - main 브랜치 푸시 시 자동 빌드 및 gh-pages 배포 설정
   - Node.js 18 환경에서 npm ci → npm run build → gh-pages 배포
   - 권한 문제 해결을 위한 설정 최적화

3. `package.json`
   - gh-pages 패키지 의존성 추가 (v6.3.0)
   - `npm run deploy` 스크립트 추가 (수동 배포용)

4. `README.md`
   - 자동 배포 설정 방법 안내 추가
   - GitHub 저장소 권한 설정 방법 상세 설명
   - 실제 배포 URL로 수정 (`https://szara7678.github.io/3D_Poly_Dynasty/`)

### 🎯 기능
- **자동 배포**: main 브랜치에 푸시할 때마다 자동으로 gh-pages 브랜치에 배포
- **수동 배포**: `npm run deploy` 명령어로 즉시 배포 가능
- **최적화된 빌드**: Vite 설정으로 GitHub Pages 서브디렉토리 배포에 최적화
- **배포 URL**: `https://szara7678.github.io/3D_Poly_Dynasty/`에서 접속 가능

### 📈 효과
- 코드 변경 시 자동으로 웹에서 확인 가능
- GitHub Actions 권한 문제 해결 방법 안내
- 404 오류 해결로 정상적인 웹사이트 접속 가능
- 별도의 서버 없이 GitHub에서 무료 호스팅
- 개발 효율성 대폭 향상

---

## 2024년 12월 19일

### 🚀 프로젝트 초기 설정 완료

#### 생성된 파일들:
1. **package.json** - React Three Fiber 프로젝트 의존성 설정
   - React 18, @react-three/fiber, @react-three/drei, Three.js 포함
   - Vite 빌드 도구 설정

2. **index.html** - 메인 HTML 템플릿
   - Tailwind CSS CDN 연결
   - React 앱 마운트 포인트 설정

3. **vite.config.js** - Vite 설정 파일
   - React 플러그인 설정
   - 개발 서버 포트 3000 설정

4. **src/main.jsx** - React 앱 진입점
   - React 18 StrictMode 설정

5. **src/App.jsx** - 메인 App 컴포넌트
   - WalkingHuman3D 컴포넌트 렌더링

6. **src/index.css** - 기본 스타일
   - 전역 CSS 리셋 및 기본 폰트 설정

7. **src/components/WalkingHuman3D.jsx** - 3D 걷는 사람 컴포넌트
   - 기존 파일을 components 폴더로 이동
   - 스틱 피규어 애니메이션 로직 포함

8. **README.md** - 프로젝트 문서
   - 기능 설명, 사용법, 기술 스택 정보

#### 핵심 기능:
- **3D 현실적 캐릭터**: 근육 정의, 체형 커스터마이징이 가능한 사람 모양
- **절차적 걷기 애니메이션**: 수학적 계산을 통한 자연스러운 걷기 동작
- **실시간 컨트롤**: WASD 이동, Shift 달리기, Space 카메라 모드 토글
- **고급 커스터마이징**: 피부색, 의상색, 체형, 근육량, 체지방률 조절
- **향상된 조명**: 다중 조명과 그림자로 현실감 증대

#### 다음 단계:
- `npm install` 실행하여 의존성 설치
- `npm run dev` 실행하여 개발 서버 시작
- 브라우저에서 http://localhost:3000 접속하여 3D 애니메이션 확인

---

## 2024년 12월 19일 (추가)

### 🎮 3D 에이전트 인스턴싱 시스템 완전 교체

#### 변경된 파일:
1. **src/components/WalkingHuman3D.jsx** - 완전히 새로운 코드로 교체
   - 기존 단일 캐릭터 시스템을 다중 에이전트 인스턴싱 시스템으로 변경

#### 새로운 핵심 기능:
- **다중 에이전트 시뮬레이션**: 최대 800개까지의 귀여운 캐릭터 동시 렌더링
- **고성능 인스턴싱**: InstancedMesh를 사용한 최적화된 렌더링
- **파스텔 톤 색상**: 골든레시오 기반의 귀여운 파스텔 색상 시스템
- **유기적 움직임**: 각 에이전트별 개별적인 보행 패턴과 방향 변화
- **실시간 에이전트 수 조절**: 슬라이더로 1~800개 에이전트 수 조절
- **자동 성능 최적화**: 모바일 기기에서 자동으로 에이전트 수 감소

#### 기술적 특징:
- **인스턴싱 메쉬**: 몸통, 머리, 팔, 다리 각각의 InstancedMesh 사용
- **동적 색상**: 에이전트별 고유한 파스텔 색상 할당
- **스프링 애니메이션**: 몸통 스쿼시와 머리 지연 효과
- **경계 처리**: 활동 영역 내에서 자연스러운 방향 전환
- **반응형 UI**: 다크 테마의 모던한 UI 디자인

#### 성능 최적화:
- **모바일 최적화**: 자동으로 에이전트 수를 160개로 제한
- **픽셀 비율 조정**: 디바이스 성능에 따른 자동 조정
- **프레임 안정화**: 큰 프레임 변동 보호 로직

#### 사용법:
- **에이전트 수 조절**: 하단 UI의 슬라이더로 1~800개 조절
- **카메라 조작**: 마우스 드래그로 회전, 휠로 줌
- **자동 최적화**: 성능에 따라 자동으로 설정 조정

---

## 2025년 09월 04일

### 🧱 게임 스캐폴딩 추가 및 보행 물리 개선

#### 추가/수정 파일
1. `src/game/state.js` — 전역 상태/세이브/간단 액션(uid/addUnit/addBuilding)
2. `src/game/gameLoop.js` — 고정 틱 루프(0.5s), 세금/저장 타이머
3. `src/game/content/_defs.sample.js`, `content/buildings.js` — 건물 정의 템플릿
4. `src/game/systems/*` — `production/economy/reputation/construction/buildingXP/spawn`
5. `src/components/HUD.jsx` — 자원/인구/명성 HUD
6. `src/App.jsx` — 게임 루프/HUD 연결, 초기 상태 샘플 주입
7. `src/components/WalkingHuman3D.jsx` — 발 고정(foot planting) + 지면 추종 + `props.units/timeScale` 지원

#### 주요 변화
- 보행: 지지발 고정, 스윙발 곡선 이동, 경사 정상화 기반 지면 높이 추종
- 렌더: `units`가 주어지면 상태 구동형 좌표/방향/크기 반영, 없으면 기존 배회 유지(혼합 모드)
- 시뮬: 생산/세금/명성/건설/건물XP/간이 스폰 루프 작동

#### 다음 권장 작업
- BuildMenu/SelectionOverlay/Inspector 구현(입력→명령)
- construction/assignment 상세 구현(코스트/시간/배치)
- worldAI/spawn/combat 루프 최소 버전

## 2025년 09월 05일

### 🔁 상태 구독/알림(pub-sub) 도입 및 UI/렌더 반응형 전환

#### 변경 파일
1. `src/game/state.js`
   - `subscribe(listener)`/`notify()` 이벤트 버스 추가
   - `setRes`/`addUnit`/`addBuilding`에서 `notify()` 호출
2. `src/game/gameLoop.js`
   - 고정 틱 루프에서 `state.tick++` 직후 `notify()` 호출
3. `src/components/HUD.jsx`
   - 스토어 구독으로 자동 리렌더(실시간 자원/인구/명성 반영)
4. `src/components/agents/Agents.jsx`
   - `props.units` 반영: 외부 상태 기반 위치/방향/크기 렌더
   - 남는 슬롯은 내부 배회(혼합 모드 유지)
5. `src/components/Scene3D.jsx`
   - 변경 없음(하위 Agents가 상태 기반 렌더 지원)
6. `README.md`
   - 상태 구독/알림 방식 문서화 및 구조/설명 최신화

#### 효과
- HUD 수치가 틱/시스템 처리에 맞춰 즉시 갱신
- 에이전트가 외부 상태(`units`) 좌표를 따라 움직임
- 기존 랜덤 배회 시각도 유지되어 가시성/몰입 유지

### 🧱 Build/배치 최소 루프 추가

#### 추가/수정 파일
1. `src/components/BuildMenu.jsx`
   - 우측 상단 건설 메뉴 UI(코스트 표시/건설 버튼)
   - 클릭 시 비용 차감 후 건물 생성(건설 진행 시작), 유휴 인원 자동 배치
2. `src/game/state.js`
   - `canAfford`/`spend` 추가(코스트 체크/지출)
   - `assignUnitToBuilding`/`unassignUnit`/`idleUnits` 추가(배치/해제/유휴 조회)
3. `src/App.jsx`
   - `BuildMenu` 추가 렌더

#### 동작
- 건설 클릭 → 자원 확인/차감 → 건물 청사진 생성(`construct.active=true`) → 자동 배치
- `systems/construction.js`에서 `eta/progress` 감소 → 완료 시 활성화

### 🧭 2025년 09월 05일 (추가)

#### 🧊 배치 고스트/반경 예외/건물 렌더
- 배치 모드에서 마우스를 따라가는 청사진(투명 상자) 표시, 반경 내 유효 시 초록/불가 시 빨강
- 마을 회관은 반경 제한 미적용(어디든 건설 가능)
- 건물 렌더: InstancedMesh 박스 메쉬, 진행도에 따라 높이 증가로 공사 시각화

### 🧩 2025년 09월 06일

#### 🛡️ 배치 규칙 강화 + 시각화 개선
- BUILDING_DEFS에 `placeRadius` 추가(타입별 반경) → 겹침 판정은 두 건물 반지름 합으로 계산
- 고스트 스케일/배경 오브젝트 제거 반경을 `placeRadius` 기반으로 자동 조정
- 회관 반경 표시: 은은한 채움 + 진한 테두리 + 점선 + 반투명 벽(높이 2.5)
- 배치 불가(반경 밖/겹침)일 때 고스트·링·벽이 빨강으로 바뀌며 클릭도 무시

#### 🏗️ 배경 오브젝트 정리
- 배치 시 주변 반경 내 나무/선인장/바위/얼음 메쉬를 제거하여 건설 공간 확보
- 스캐터를 하나의 `Group`으로 관리해 성능/정리 용이

#### 🖱️ 선택/인스펙션
- 더블클릭으로 건물 선택 → 반경 기반 선택 링 표시, 카메라가 부드럽게 포커스 이동
- `Inspector` 패널 추가: 이름/레벨/HP/XP/공사 ETA·진행률, 배치 인원/유휴 인원 관리(배치/해제)

### 🧍‍♂️ 캐릭터 비율 및 모션 리파인

#### 수정 파일
- `src/components/WalkingHuman3D.jsx`

#### 변경 사항
- 얼굴 배치 보정: 눈 간격/높이/앞쪽 오프셋을 현실 비율에 가깝게 조정
- 팔다리 부착점 개선: 어깨 높이 상승, 약간의 전방 오프셋, 고관절 높이 하향 조정
- 보행 리듬 강화: 골반 좌우 스웨이, 상하 바운스, 어깨의 미세 요우/롤 추가로 자연스러운 실루엣
- 팔 스윙 개선: 전후 스윙과 약간의 좌우 흔들림 추가, 손 목표점 곡선 보정
- 입 위치 소폭 상향으로 표정 자연스러움 향상

### 🌍 지형 바이옴 시스템 + 현실적인 팔레트

#### 수정 파일
- `src/components/WalkingHuman3D.jsx`
- `src/world/terrain.js` (신규)

#### 변경 사항
- 팔: 긴 원통 대신 짧은 팔 + 구형 손 파트 추가, 다리 제거
- 상태 기반 모션: 
  - 걷기: 팔 전후 스윙, 몸 상하 바운스
  - 작업(채광/농사/벌목): 양손 위→아래 반복 동작 (느린 속도로 개선)
- 색상 팔레트: 기본값을 `realistic`로 변경(채도↓, 명도↓, 어스톤)
- 지형 모듈화: `src/world/terrain.js`로 분리하여 재사용성 향상
- 바이옴 분포 개선: 맵 크기 300x300으로 확장, 모든 바이옴이 균등하게 나타나도록 조정
- 바이옴별 오브젝트: 숲(나무+줄기), 평원(바위), 사막(선인장), 설원(얼음기둥) 스캐터링
- 오브젝트 밀도 증가: 1200개로 증가하여 바이옴 구분 명확화

#### 기대 효과
- 활동 종류에 따른 동작 차별화로 가독성과 몰입감 향상
- 맵이 생성될 때마다 규칙 있는 랜덤 바이옴 배치로 탐색 재미 증대
- 모든 바이옴이 맵에 균등하게 분포하여 다양성 확보

#### 기대 효과
- 팔다리가 몸통에 ‘붙어 있는’ 느낌 강화, 전신 균형감 개선
- 보행 중 무게중심 이동이 느껴져 더 사람다운 움직임 연출

## 2024년 12월 19일 (오류 수정)

### 🔧 Flow 타입 문법 오류 수정

#### 발생한 문제:
- **Babel 오류**: Flow 타입 문법이 지원되지 않아 컴파일 실패
- **오류 메시지**: "Support for the experimental syntax 'flow' isn't currently enabled"

#### 수정 내용:
1. **src/components/WalkingHuman3D.jsx** - Flow 타입 문법 완전 제거
   - `export type CuteAgents3DProps` 제거
   - `type Agent`, `type Parts` 등 모든 타입 정의 제거
   - 함수 매개변수의 타입 어노테이션 제거
   - `useRef<HTMLDivElement | null>(null)` → `useRef(null)` 변경

#### 수정된 구조:
- **순수 JavaScript**: 모든 Flow 타입 문법을 제거하고 일반 JavaScript로 변경
- **React 컴포넌트**: 기존 기능은 그대로 유지하면서 타입 문법만 제거
- **호환성 향상**: Babel 설정 없이도 정상 동작

#### 결과:
- ✅ 컴파일 오류 해결
- ✅ 개발 서버 정상 실행 가능
- ✅ 모든 기능 정상 동작
- ✅ 모바일 최적화 및 성능 최적화 유지

---

## 2025-01-12 - 주요 시스템 오류 해결

### 📋 작업 개요
**Scene3D.jsx 500 오류 및 관련 시스템 문제들을 종합적으로 해결**

사용자 보고 문제:
- Scene3D.jsx 파일 로딩 시 500 Internal Server Error
- 건물 고스트(청사진) 렌더링 안됨
- 마을 범위 겹치는 부분이 자연스럽지 않음
- 마을 회관 건설 시 에이전트 생성 문제

### 🔧 수정 사항

#### 1. Scene3D.jsx 완전 복구
**파일**: `src/components/Scene3D.jsx`
- **문제**: 파일이 손상되어 import/export 구문이 없고 구조가 불완전
- **해결**: 파일을 완전히 새로 작성하여 복구
  - React/Three.js 기본 구조 복구
  - 건물 인스턴싱 메쉬 시스템 복구
  - 건설 ETA 라벨 시스템 복구
  - 마우스 상호작용 (배치/선택) 복구
  - 카메라 포커스 및 키보드 컨트롤 복구

#### 2. terrain.js export 오류 해결
**파일**: `src/world/terrain.js`
- **문제**: `createTerrainSystem` 함수만 export하고 있어서 Scene3D.jsx에서 terrain 객체를 직접 import할 수 없음
- **해결**: 기본 terrain 인스턴스를 생성하여 export
```javascript
// 추가된 코드:
export const terrain = createTerrainSystem();
```

#### 3. 건물 고스트 메쉬 시스템 복구
**파일**: `src/components/Scene3D.jsx`
- **기능**: 배치 모드에서 건물 청사진 렌더링
- **구현**: 
  - state.ui.placing 상태에 따른 고스트 메쉬 생성/제거
  - 마우스 위치 추적 및 유효성 검사에 따른 색상 변경
  - 건물 크기에 맞는 스케일링

#### 4. 마을 범위 겹침 자연스러운 처리
**파일**: `src/components/Scene3D.jsx`
- **기능**: 다중 마을 회관의 범위가 겹칠 때 자연스러운 병합 효과
- **구현**:
  - 겹치는 마을 범위 감지 로직
  - 겹치는 부분의 투명도 조정 (opacity 감소)
  - 시각적으로 자연스러운 병합 효과

#### 5. 초기 에이전트 생성 문제 해결
**파일**: `src/App.jsx`
- **문제**: 초기 인구수가 0으로 설정되어 에이전트가 보이지 않음
- **해결**: 게임 시작 시 기본 시민 5명 생성
```javascript
// 수정된 코드:
const initialPopulation = 5;
for(let i=0;i<initialPopulation;i++){
  // 시민 생성 로직
}
state.population = initialPopulation;
```

### 📊 시스템 상태

#### 렌더링 시스템:
- ✅ Scene3D.jsx 완전 복구
- ✅ 건물 인스턴싱 메쉬 정상 작동
- ✅ 건물 고스트 렌더링 복구
- ✅ 마을 범위 표시 및 겹침 처리 개선
- ✅ 건설 ETA 라벨 시스템 정상 작동

#### 게임 시스템:
- ✅ 초기 시민 5명 생성
- ✅ 마을 회관 건설 시 시민 추가 (기존 로직 정상)
- ✅ 에이전트 렌더링 및 애니메이션 정상
- ✅ 건물 배치 및 상호작용 정상

#### 성능 최적화:
- ✅ InstancedMesh 기반 건물 렌더링
- ✅ 프레임 안정화 로직 유지
- ✅ 모바일 최적화 유지

### 🎯 결과
- ✅ Scene3D.jsx 500 오류 완전 해결
- ✅ 건물 고스트 렌더링 정상 작동
- ✅ 마을 범위 겹침 자연스러운 병합 효과
- ✅ 에이전트 생성 및 렌더링 정상 작동
- ✅ 모든 3D 렌더링 시스템 정상화
- ✅ 게임 플레이 완전 복구

---

## 2025-01-12 - Scene3D.jsx 리팩토링 및 모듈화

### 📋 작업 개요
**Scene3D.jsx 파일이 너무 길고 복잡해져서 기능별로 분리하여 모듈화**

### 🔧 분리된 모듈들

#### 1. BuildingManager.js
**위치**: `src/components/managers/BuildingManager.js`
**기능**: 건물 렌더링 및 인스턴싱 관리
- 건물 타입별 지오메트리와 재질 정의
- InstancedMesh를 사용한 고성능 건물 렌더링
- 건물 상태에 따른 동적 갱신
- 리소스 정리 및 메모리 관리

#### 2. LabelManager.js
**위치**: `src/components/managers/LabelManager.js`
**기능**: 건설 ETA 라벨 및 시민 이름 라벨 관리
- 건설 중인 건물의 ETA 표시
- 완성된 건물 내 숨겨진 시민들의 이름 표시
- Canvas 기반 텍스트 스프라이트 생성
- 라벨 위치 및 텍스트 동적 업데이트

#### 3. TownRangeManager.js
**위치**: `src/components/managers/TownRangeManager.js`
**기능**: 마을 범위 표시 및 겹침 처리
- 회관별 마을 범위 시각화 (채우기, 테두리, 벽)
- 다중 회관 범위 겹침 감지 및 투명도 조정
- 배치 모드에 따른 범위 색상 변경
- 레벨에 따른 범위 크기 동적 조정

#### 4. InteractionHandler.js
**위치**: `src/components/managers/InteractionHandler.js`
**기능**: 마우스 상호작용 처리
- 클릭/더블클릭/우클릭 이벤트 처리
- 건물 배치 유효성 검사 및 고스트 메쉬 업데이트
- 건물/유닛 선택 및 포커스 이동
- 배경 오브젝트 제거 및 건물 배치 처리

#### 5. SelectionRingManager.js
**위치**: `src/components/managers/SelectionRingManager.js`
**기능**: 선택된 건물/유닛의 링 표시
- 선택된 건물의 반경 기반 링 표시
- 선택된 유닛의 고정 크기 링 표시
- 선택 해제 시 링 숨김 처리
- 링 지오메트리 동적 생성 및 업데이트

### 🔄 Scene3D.jsx 리팩토링

#### 변경 사항:
1. **모듈 import**: 분리된 매니저 클래스들을 import
2. **매니저 초기화**: 각 매니저를 씬에 맞게 초기화
3. **기능 위임**: 기존 인라인 함수들을 매니저 메서드로 대체
4. **상태 관리**: threeRef에 매니저들을 저장하여 접근 가능하도록 설정
5. **정리 로직**: 각 매니저의 dispose 메서드 호출로 리소스 정리

#### 코드 구조 개선:
- **가독성 향상**: 873줄 → 약 300줄로 대폭 단축
- **유지보수성**: 기능별 분리로 수정 시 영향 범위 최소화
- **재사용성**: 각 매니저는 독립적으로 사용 가능
- **확장성**: 새로운 기능 추가 시 해당 매니저만 수정하면 됨

### 📊 시스템 상태

#### 렌더링 시스템:
- ✅ 건물 렌더링 시스템 모듈화 완료
- ✅ 라벨 관리 시스템 모듈화 완료
- ✅ 마을 범위 표시 시스템 모듈화 완료
- ✅ 상호작용 처리 시스템 모듈화 완료
- ✅ 선택 링 표시 시스템 모듈화 완료

#### 성능 최적화:
- ✅ 각 매니저별 독립적인 리소스 관리
- ✅ 메모리 누수 방지를 위한 명시적 dispose 호출
- ✅ 기존 InstancedMesh 최적화 유지

### 🎯 결과
- ✅ Scene3D.jsx 코드 길이 65% 단축 (873줄 → 300줄)
- ✅ 기능별 모듈화로 유지보수성 대폭 향상
- ✅ 각 매니저의 독립적 동작으로 안정성 증대
- ✅ 새로운 기능 추가 시 확장성 확보
- ✅ 기존 기능 완전 보존 및 정상 동작

---

### 📋 작업 개요
**초기 시민을 0명으로 되돌리고 마을 회관 건설 시 시민 생성 문제 해결**

### 🔧 수정 사항

#### 1. 초기 시민 수 조정
**파일**: `src/App.jsx`
- **변경**: 초기 시민 5명 → 0명으로 변경
- **목적**: 마을 회관 건설을 통해서만 시민을 얻도록 게임 플레이 조정

#### 2. 마을 회관 시민 생성 개선
**파일**: `src/game/systems/construction.js`
- **개선사항**:
  - 명시적 `notify()` 호출 추가로 UI 업데이트 보장
  - 디버깅용 console.log 추가로 시민 생성 과정 추적
  - 시민 생성 및 위치 정보 로깅

```javascript
// 추가된 개선사항:
console.log(`마을 회관 건설 완료! 시민 3명 추가`);
console.log(`시민 ${i+1} 생성: 위치 (${ux.toFixed(1)}, ${uz.toFixed(1)})`);
notify(); // 명시적 상태 변경 알림
console.log(`총 시민 수: ${Object.keys(state.units).length}, 인구: ${state.population}`);
```

### 🎯 결과
- ✅ 초기 시민 0명으로 조정
- ✅ 마을 회관 건설 시 시민 3명 생성 로직 개선
- ✅ UI 업데이트 보장을 위한 명시적 notify() 호출
- ✅ 디버깅 정보 추가로 문제 추적 가능

---

## 2025-09-09 - 시민 스탯/스킬/수련치/인벤토리 도입 + 랜덤 스폰

### 📦 추가 파일
1. `src/game/content/units.js`
   - `STAT_KEYS`, `SKILL_KEYS`, `BASE_STATS`, `DEFAULT_INVENTORY()`
   - `rollStats()`, `rollSkills()`, `rollTraining()`
   - `randomName()`, `randomAppearance()`
2. `src/game/factory/citizen.js`
   - `createRandomCitizen(pos)` — 무작위 이름/외형/스탯/스킬/수련치/인벤토리 부여

### 🔧 변경 파일
1. `src/game/systems/construction.js`
   - 회관 완공 시 시민 스폰을 `createRandomCitizen` 기반으로 교체
   - 랜덤 외형/이름/스탯/스킬/수련치가 적용되도록 통합

### ✅ 효과
- 회관 완공마다 고유한 시민이 생성되어 몰입 및 다양성 향상
- `Agents`는 `size/pos/dir`를 반영하여 즉시 시각화

### 👆 시민 선택 및 인스펙터 3단 UI

#### 변경 파일
1. `src/game/state.js`
   - `ui.selectedUnitId` 추가, `setSelectedUnit(id)`/상호배타 로직(건물 선택 해제)
2. `src/components/Scene3D.jsx`
   - 클릭/더블클릭 피킹: 유닛 우선 → 건물, 선택 링(유닛/건물 공용)
3. `src/components/Inspector.jsx`
   - 시민 선택 시 3단 정보 표시(스탯, 스킬/수련 스크롤, 인벤토리 스크롤)

#### 효과
- 시민을 클릭하면 건물과 동일한 방식으로 선택/포커스 가능
- 인스펙터에서 시민 능력치/스킬(재능)/수련치/인벤토리를 직관적으로 확인

### 🏷️ 시민 머리 위 라벨 + 선택 하이라이트

#### 변경 파일
1. `src/components/agents/Agents.jsx`
   - 이름 + 작업 이모지 라벨(Sprite) 추가, 작업 이모지 매핑(건물 타입→이모지)
   - 선택된 유닛에 헤드 주변 할로 스프라이트 표시(아웃라인 유사)

#### 효과
- 각 시민 머리 위에 이름과 현재 배정 작업 상태가 이모지로 표시됨
- 선택 시 시각적 강조로 식별성 향상

### 🖱️ 우클릭 이동(시민)

#### 추가/변경 파일
1. `src/game/systems/movement.js` (신규)
   - `runMovement()` 추가: `unit.moveTo`가 있으면 목표로 보간 이동, 도달 시 idle
2. `src/game/gameLoop.js`
   - 틱 순서에 `runMovement()` 추가
3. `src/game/state.js`
   - `setUnitMoveTarget(unitId, x, z)` 액션 추가
4. `src/components/Scene3D.jsx`
   - 선정 유닛이 있을 때 우클릭 지점으로 이동 명령 발행(컨텍스트 메뉴 차단)

#### 효과
- 시민을 클릭해 선택 후, 땅을 우클릭하면 해당 지점으로 이동합니다.
### 🧌 몬스터 시스템 통합 및 간소화

#### 변경 파일
1. **삭제된 파일들**
   - `src/components/managers/MonsterManager.js` - 몬스터 전용 렌더링 매니저 삭제
   - `src/components/animations/MonsterAnimations.js` - 몬스터 전용 애니메이션 삭제
   - `src/game/systems/monsterAI.js` - 복잡한 몬스터 AI 시스템 삭제
   - `src/game/systems/monsterSystem.js` - 기존 몬스터 시스템 삭제
   - `src/game/systems/monsterNests.js` - 기존 군락지 시스템 삭제
   - `src/game/content/monsters.js` - 몬스터 정의 파일 삭제

2. **새로 생성된 파일**
   - `src/game/systems/simpleMonsterSystem.js` - 간소화된 몬스터 시스템 (랜덤 이동)

3. **수정된 파일들**
   - `src/components/rendering/EntityRenderer.jsx`
     - 몬스터와 시민이 동일한 메쉬 사용하도록 통합
     - 몬스터는 초록색 고블린으로 통일
     - 몬스터 라벨을 "고블린"으로 표시
   - `src/game/state.js`
     - 몬스터 시스템 초기화 함수 간소화
     - 간단한 고블린 2마리 생성
   - `src/game/factory/citizen.js`
     - 시민 생성 시 `team: 0` 속성 추가 (플레이어 소속)
   - `src/game/content/_defs.sample.js`
     - 몬스터 군락 건물을 일반 생산 건물로 변경
     - 몬스터 생산 기능 추가
   - `src/game/systems/production.js`
     - 몬스터 생산 처리 로직 추가
     - 몬스터 군락에서 고블린 생산
   - `src/game/gameLoop.js`
     - 새로운 간소화된 몬스터 시스템 사용
   - `src/components/managers/InteractionHandler.js`
     - 팀 0(플레이어 소속) 유닛만 클릭/조종 가능하도록 수정

#### 주요 변경사항
1. **렌더링 통합**: 몬스터와 시민이 동일한 메쉬와 애니메이션 사용
2. **몬스터 통일**: 모든 몬스터를 초록색 고블린으로 통일
3. **팀 시스템**: agent에 소속 팀 속성 추가 (0: 플레이어, 1,2,3: 종족별)
4. **간소화된 AI**: 복잡한 몬스터 AI 대신 랜덤 좌표 이동
5. **몬스터 생산**: 몬스터 군락을 일반 건물처럼 변경하여 몬스터 생산
6. **상호작용 제한**: 플레이어 소속 유닛만 클릭/조종 가능

#### 효과
- 몬스터와 시민이 동일한 외형으로 통합되어 일관성 향상
- 복잡한 몬스터 AI 제거로 성능 개선
- 팀 시스템으로 플레이어와 적 구분 명확화
- 몬스터 군락을 통한 몬스터 생산 가능

### 🧠 수련 → practice(0~5) 개편 및 재능 영향

#### 변경 파일
1. `src/game/content/units.js`
   - `rollTraining()` → `rollPractice()`(정수 0~5), `rollSkills()` → `rollTalent()`로 명칭 변경
2. `src/game/factory/citizen.js`
   - 생성 필드: `skills`는 재능, `practice`는 수련치로 채움
3. `src/components/Inspector.jsx`
   - 스킬 목록을 `이름(재능) 수련치` 포맷으로 병합 표시
4. `src/game/systems/production.js`
   - 생산 효율에 수련치(단계당 +4%) 반영, 재능은 소폭 유지(0.4배)

#### 효과
- 수련치가 높을수록 관련 행동의 즉시 효율 증가
- 재능은 수련 속도(향후 성장 로직)와 소폭 효율에 기여

### ✂️ 마을 범위 겹침 클리핑 시스템 (셰이더 기반)

#### 변경 파일
1. `src/components/managers/TownRangeManager.js`
   - 테두리(링)와 벽에 커스텀 셰이더 머티리얼 적용
   - `createClippingEdgeMaterial()`, `createClippingWallMaterial()` 함수로 클리핑 셰이더 생성
   - 겹치는 부분부터 바깥쪽을 실제로 잘라내는 `discard` 처리
   - 각 회관의 중심/반경 정보를 uniforms로 주입하여 다른 회관 원 내부 픽셀 제거
   - 배치 모드 색상 변경도 셰이더 uniforms 기반으로 처리

#### 효과
- 마을 범위가 겹칠 때 겹치는 부분부터 바깥쪽 링이 실제로 잘려서 융합된 것처럼 보임
- 투명도 조절이 아닌 실제 클리핑으로 더 자연스러운 합집합 효과
- 테두리와 벽이 겹치는 구간에서 중복 렌더링되지 않아 깔끔한 시각적 표현

---

## 2025-01-12 - 생산 시스템 대폭 개선

### 📋 작업 개요
**기존 생산 시스템을 시간 기반으로 완전히 재설계하고 시각적 피드백 강화**

### 🔧 주요 변경사항

#### 1. 자원 시스템 단순화
**파일**: `src/game/state.js`
- **변경**: 돌(stone) 자원 완전 제거
- **효과**: 자원 관리 단순화, 게임 밸런스 조정

#### 2. 건물 정의 개선
**파일**: `src/game/content/_defs.sample.js`
- **변경사항**:
  - 모든 건물의 건설 비용에서 돌(stone) 제거
  - 생산품 수량을 정수로 변경 (기존 소수점 → 정수)
  - 각 생산품마다 생산 시간 정의 추가
  - 사냥꾼의 집 → 나무꾼의 집 (나무만 생산)
  - 채집꾼의 집 (허브만 생산)
  - 전사의 집, 마탑, 대장간 (수련치만 획득, crafts/onRaid 제거)

#### 3. 생산 시스템 완전 재설계
**파일**: `src/game/systems/production.js`
- **새로운 기능**:
  - 시민별 개별 생산 진행률 시스템
  - 시민이 숨겨진 순간부터 개별 생산 시작
  - 각 시민의 스탯과 스킬에 따른 개별 생산량
  - 생산 완료 시 정수 단위로 자원 획득
  - 분리된 수련치 상승 시스템 사용
  - 수련 전용 건물 지원 (trains 속성 처리)

#### 3-1. 수련치 상승 시스템 분리
**파일**: `src/game/systems/skillTraining.js` (신규)
- **새로운 기능**:
  - 생산, 전투 등 스킬 사용으로 인한 수련치 상승 관리
  - 재능과 수련치에 따른 확률 계산 시스템
  - 향후 전투 시스템 확장을 위한 확장 가능한 구조

#### 4. 시민 숨김 처리 시스템
**파일**: `src/game/systems/movement.js` (기존 구현 확인)
- **기능**: 시민이 건물에 도착하면 자동으로 숨김 처리
- **효과**: 시민이 건물 내부에서 작업하는 것처럼 시각화

#### 5. 생산 진행률 시각화
**파일**: `src/components/managers/LabelManager.js`
- **새로운 기능**:
  - 건물 상단 이름표에 생산 진행률 바 표시
  - 진행률에 따라 배경색이 차오르는 애니메이션
  - 실시간 생산 상태 시각적 피드백

### 🎯 시스템 상세

#### 생산 진행률 시스템:
- 각 시민별로 개별적인 생산 진행률 관리
- 시민이 숨겨진 순간부터 개별 생산 시작
- 진행률은 고정된 속도로 증가 (효율과 무관)
- 각 시민의 스탯과 스킬에 따른 개별 생산량
- 인구수 배율 적용 (인구 1명당 10% 생산량 증가)
- 생산 완료 시 진행률 리셋 및 자원 획득

#### 재능 기반 수련치 상승:
- 재능 범위: 0~10 (모든 스킬 동일, Admin 가중 제거)
- 초기 수련치 범위: 0~10 (기존 0~100에서 변경)
- 최대 수련치: 500 (기존 100에서 변경)
- 기본 2% 확률로 수련치 상승 (최소 0.1% 확률 보장)
- 재능이 낮으면 기하급수적으로 낮은 확률 (재능 0일 때 거의 불가능)
- 재능이 높을수록 확률 증가 (최대 10% 추가)
- 수련치가 높을수록 확률 감소 (500일 때 90% 감소)
- 수련치 상승 시 생산 효율 향상
- 수련치 상승 시스템을 별도 파일(`skillTraining.js`)로 분리

#### 세금 시스템 개선:
- 기존 시간 기반 세금 시스템 제거
- 마을 회관에서 배치된 시민이 금(gold) 생산 (10초마다 1개)
- 세금도 다른 생산품과 동일한 방식으로 처리
- Admin 스킬을 사용한 생산으로 수련치 상승 가능

#### 시각적 피드백:
- 시민이 건물에 들어가면 이름표에 생산 진행률 표시
- 진행률 바가 녹색으로 차오르며 생산 상태 시각화
- 생산 완료 시 자원 획득 및 수련치 상승 알림

### 📊 시스템 상태

#### 생산 시스템:
- ✅ 시민별 개별 생산 진행률 시스템 완성
- ✅ 시민이 숨겨진 순간부터 개별 생산 시작
- ✅ 각 시민의 스탯과 스킬에 따른 개별 생산량
- ✅ 정수 단위 자원 생산 시스템 완성
- ✅ 재능에 따른 확률적 수련치 상승 시스템 완성
- ✅ 시민 숨김 처리 시스템 정상 작동
- ✅ 생산 진행률 시각화 시스템 완성

#### 게임 밸런스:
- ✅ 자원 시스템 단순화 (돌 제거)
- ✅ 건물별 생산 시간 차별화
- ✅ 생산품 수량 정수화로 명확한 피드백

### 🎯 결과
- ✅ 기존 연속 생산 → 시민별 개별 생산으로 완전 전환
- ✅ 시민이 건물에 들어가서 개별 작업하는 몰입감 증대
- ✅ 각 시민의 능력에 따른 개별 생산량 차별화
- ✅ 생산 진행률 시각화로 게임 상태 명확한 파악
- ✅ 재능 시스템을 통한 시민 성장 요소 강화
- ✅ 자원 관리 단순화로 게임 플레이 집중도 향상

---

## 📅 2024-12-19 - 스킬 및 스탯 시스템 대폭 개선

### 🎯 주요 변경사항

#### 1. 스킬 시스템 개선
**파일**: `src/game/content/units.js`, `src/game/content/_defs.sample.js`, `src/components/managers/BuildingManager.js`
- **변경사항**:
  - Hunting 스킬 → Woodcutting 스킬로 변경
  - 나무꾼의 집이 Woodcutting 스킬 사용
  - BuildingManager에서 hunter → woodcutter 타입 변경 (렌더링 문제 해결)

#### 2. 스탯 성장 시스템 구현
**파일**: `src/game/systems/skillTraining.js`
- **새로운 기능**:
  - 수련치 상승 시 관련 스탯 자동 증가
  - 스킬별 스탯 증가 매핑:
    - 농사(Farming): 체력 +2
    - 벌목(Woodcutting): 힘 +1, 체력 +1
    - 채집(Gathering): 민첩 +2
    - 광부(Mining): 힘 +1, 체력 +1
    - 전사(Sword): 힘 +2, 민첩 +1, 체력 +1
    - 마법(Magic): 지력 +2
    - 대장장이(Smithing): 힘 +1, 체력 +1
    - 행정(Admin): 지력 +1, 민첩 +1
  - 수련치 10의 배수마다 스탯 증가
  - HP/MP 자동 재계산

#### 3. 생산 효율 개선
**파일**: `src/game/systems/production.js`
- **새로운 기능**:
  - 스킬별 관련 스탯 보너스 추가
  - 각 스킬에 맞는 스탯이 생산 효율에 더 큰 영향
  - 예: 농사는 체력, 벌목은 힘+체력, 채집은 민첩

#### 4. 이동 속도 개선
**파일**: `src/game/systems/movement.js`
- **변경사항**:
  - 민첩(AGI) 스탯이 이동 속도에 더 강하게 영향
  - 기본 속도 0.8 + 민첩*0.04

#### 5. 전투 스탯 시스템 구현
**파일**: `src/game/factory/citizen.js`, `src/game/systems/skillTraining.js`, `src/components/Inspector.jsx`
- **새로운 기능**:
  - 공격력: 힘*2 + 민첩*0.5
  - 방어력: 체력*1.5 + 민첩*0.5
  - 마법 공격력: 지력*2
  - 스탯 증가 시 전투 스탯 자동 재계산
  - Inspector에서 전투 스탯 표시

### 🎯 결과
- ✅ 스킬과 스탯의 연관성 강화로 성장 요소 증대
- ✅ 각 스킬별 특화된 스탯 성장으로 차별화된 시민 육성
- ✅ 생산 효율에 스탯 영향 추가로 전략적 요소 강화
- ✅ 민첩 스탯의 실질적 효과로 스탯 밸런스 개선
- ✅ 전투 시스템 기반 마련으로 향후 확장 가능

---

## 📅 2024-12-19 - MP/HP 최대치 도입 및 계산 시스템 개선

### 🎯 주요 변경사항

#### 1. MP/HP 계산 함수 모듈화
**파일**: `src/game/factory/citizen.js`
- **변경사항**:
  - `calculateMP(int)` 함수: 지력 스탯 기반 MP 계산
  - `calculateHP(vit)` 함수: 체력 스탯 기반 HP 계산
  - `calculateCombatStats(stats)` 함수: 전투 스탯 계산
  - 시민 생성 시 `hpMax/mpMax` 계산 후 현재치를 최대치로 초기화

#### 2. 스탯 증가 시 최대치/현재치 재계산
**파일**: `src/game/systems/skillTraining.js`
- **변경사항**:
  - `skillTraining.js`에서 VIT/INT 상승 시 `hpMax/mpMax` 갱신
  - 현재 `hp/mp`는 최대치를 초과하지 않도록 캡 처리(최초 없음 시 최대치로 초기화)
  - 전투 스탯은 함수 호출로 일관 재계산

#### 3. 시스템/UI 개선
- **변경사항**:
  - `Inspector.jsx`의 기본 정보 영역에서 HP/MP를 `현재/최대` 형식으로 표시
- **효과**:
  - MP/HP가 INT/VIT 변화에 따라 동적으로 변동(최대치 포함)
  - 전투 스탯이 모든 스탯 변화에 따라 자동 재계산
  - 코드 모듈화로 유지보수성 향상

### 🎯 결과
- ✅ MP가 INT 스탯에 따라 동적으로 변동
- ✅ HP가 VIT 스탯에 따라 동적으로 변동
- ✅ 전투 스탯이 모든 스탯 변화에 따라 자동 재계산
- ✅ 코드 모듈화로 유지보수성 향상

---

### 🎯 주요 변경사항

#### 1. 시민 인스펙터 레이아웃 재구성
**파일**: `src/components/Inspector.jsx`
- **변경사항**:
  - 기존 3칸 레이아웃을 유지하되 첫 번째 칸에 모든 기본 정보 통합
  - 첫 번째 칸: 레벨, HP, MP, 스탯(STR/AGI/VIT/INT), 전투스탯(공격력/방어력/마법공격)
  - 두 번째 칸: 스킬(재능) 및 수련치 정보
  - 세 번째 칸: 인벤토리 정보
  - 상단 중복 정보 제거 (레벨/HP/MP는 첫 번째 칸에만 표시)

#### 2. 정보 표시 최적화
- **효과**:
  - 시민의 모든 핵심 정보를 한 눈에 파악 가능
  - 공간 효율성 향상으로 더 많은 정보 표시
  - 시각적 일관성 개선

### 🎯 결과
- ✅ 시민 인스펙터의 정보 밀도 향상
- ✅ 사용자 경험 개선 (한 번에 모든 정보 확인)
- ✅ UI 공간 효율성 최적화

---

### 🎯 주요 변경사항

#### 1. 건물 경험치 시스템 개선
**파일**: `src/game/systems/production.js`, `src/game/systems/buildingXP.js`
- **변경사항**:
  - 패시브 경험치 증가 제거 (기존 0.2/틱)
  - 생산 완료 시에만 경험치 증가 (생산량 × 2)
  - 수련 완료 시 고정 경험치 증가 (5점)
  - 건물 레벨업은 생산/수련 활동에만 의존

#### 2. 명성 시스템 개선
**파일**: `src/game/systems/reputation.js`
- **변경사항**:
  - 기존 인구 증가 요구치 시스템 제거
  - 건물 레벨 기반 명성 증가 (레벨당 0.1명성/틱)
  - 더 높은 레벨의 건물일수록 더 많은 명성 획득

#### 3. 인구 시스템 완전 재설계
**파일**: `src/game/state.js`, `src/game/systems/populationGrowth.js` (신규)
- **변경사항**:
  - 최대 인구(popCap) 개념 완전 제거
  - 명성 기반 동적 인구 증가 시스템 구현
  - 명성에 비해 인구가 적으면 높은 확률로 인구 증가
  - 명성에 비해 인구가 많으면 낮은 확률로 인구 증가
  - 새로운 시민은 랜덤한 마을 회관 주변에 생성

#### 4. 게임 루프 업데이트
**파일**: `src/game/gameLoop.js`
- **변경사항**:
  - 새로운 인구 증가 시스템 통합
  - 시스템 실행 순서 최적화

### 🎯 결과
- ✅ 건물 경험치가 실제 활동에만 의존하여 의미 있는 성장
- ✅ 명성이 건물 발전과 직접적으로 연결된 명확한 시스템
- ✅ 인구 제한 없는 자연스러운 성장 시스템
- ✅ 명성과 인구의 균형잡힌 관계로 게임 밸런스 개선
- ✅ 마을 회관 중심의 인구 증가로 전략적 요소 강화

---

## 📅 2025-01-12 - 우상단 메인 메뉴 시스템 구현

### 🎯 주요 변경사항

#### 1. MainMenu 컴포넌트 생성
**파일**: `src/components/MainMenu.jsx` (신규)
- **기능**: 우상단에 건축🏗️, 건물🏠, 시민👥, 외교🤝 버튼으로 구성된 탭 메뉴 시스템
- **구조**: 각 버튼 클릭 시 해당 탭의 박스가 나타나는 시스템
- **상태 관리**: React useState를 사용한 탭 활성화 상태 관리

#### 2. 탭별 기능 구현
- **건축 탭**: 기존 BuildMenu와 동일한 건물 목록 및 건설 비용 표시, 클릭 시 건설 모드 진입
- **건물 탭**: 현재 건물 목록 표시 (이름, 레벨, HP), 클릭 시 인스펙터에서 건물 정보 확인
- **시민 탭**: 현재 시민 목록 표시 (이름, 레벨, HP), 클릭 시 인스펙터에서 시민 정보 확인
- **외교 탭**: 미구현 상태 메시지 표시

#### 3. App.jsx 통합
**파일**: `src/App.jsx`
- **변경사항**: 기존 BuildMenu 컴포넌트를 MainMenu로 교체
- **효과**: 새로운 통합 메뉴 시스템으로 UI 일관성 향상

#### 4. README.md 업데이트
**파일**: `README.md`
- **변경사항**: MainMenu 기능 설명 추가, 프로젝트 구조 업데이트
- **효과**: 문서와 실제 구현의 일치성 확보

### 🎯 결과
- ✅ 우상단에 통합된 탭 메뉴 시스템 완성
- ✅ 건축, 건물, 시민, 외교 기능을 하나의 인터페이스로 통합
- ✅ 각 탭에서 클릭 시 기존 인스펙터 시스템과 연동
- ✅ 사용자 경험 향상 및 UI 일관성 개선
- ✅ 향후 외교 기능 확장을 위한 구조 마련
